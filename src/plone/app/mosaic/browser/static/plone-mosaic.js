(function(){function a(a){function b(b,c,d,e,f,g){for(;f>=0&&g>f;f+=a){var h=e?e[f]:f;d=c(d,b[h],h,b)}return d}return function(c,d,e,f){d=t(d,f,4);var g=!A(c)&&s.keys(c),h=(g||c).length,i=a>0?0:h-1;return arguments.length<3&&(e=c[g?g[i]:i],i+=a),b(c,d,e,g,i,h)}}function b(a){return function(b,c,d){c=u(c,d);for(var e=z(b),f=a>0?0:e-1;f>=0&&e>f;f+=a)if(c(b[f],f,b))return f;return-1}}function c(a,b,c){return function(d,e,f){var g=0,h=z(d);if("number"==typeof f)a>0?g=f>=0?f:Math.max(f+h,g):h=f>=0?Math.min(f+1,h):f+h+1;else if(c&&f&&h)return f=c(d,e),d[f]===e?f:-1;if(e!==e)return f=b(k.call(d,g,h),s.isNaN),f>=0?f+g:-1;for(f=a>0?g:h-1;f>=0&&h>f;f+=a)if(d[f]===e)return f;return-1}}function d(a,b){var c=F.length,d=a.constructor,e=s.isFunction(d)&&d.prototype||h,f="constructor";for(s.has(a,f)&&!s.contains(b,f)&&b.push(f);c--;)f=F[c],f in a&&a[f]!==e[f]&&!s.contains(b,f)&&b.push(f)}var e=this,f=e._,g=Array.prototype,h=Object.prototype,i=Function.prototype,j=g.push,k=g.slice,l=h.toString,m=h.hasOwnProperty,n=Array.isArray,o=Object.keys,p=i.bind,q=Object.create,r=function(){},s=function(a){return a instanceof s?a:this instanceof s?void(this._wrapped=a):new s(a)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=s),exports._=s):e._=s,s.VERSION="1.8.3";var t=function(a,b,c){if(void 0===b)return a;switch(null==c?3:c){case 1:return function(c){return a.call(b,c)};case 2:return function(c,d){return a.call(b,c,d)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)}}return function(){return a.apply(b,arguments)}},u=function(a,b,c){return null==a?s.identity:s.isFunction(a)?t(a,b,c):s.isObject(a)?s.matcher(a):s.property(a)};s.iteratee=function(a,b){return u(a,b,1/0)};var v=function(a,b){return function(c){var d=arguments.length;if(2>d||null==c)return c;for(var e=1;d>e;e++)for(var f=arguments[e],g=a(f),h=g.length,i=0;h>i;i++){var j=g[i];b&&void 0!==c[j]||(c[j]=f[j])}return c}},w=function(a){if(!s.isObject(a))return{};if(q)return q(a);r.prototype=a;var b=new r;return r.prototype=null,b},x=function(a){return function(b){return null==b?void 0:b[a]}},y=Math.pow(2,53)-1,z=x("length"),A=function(a){var b=z(a);return"number"==typeof b&&b>=0&&y>=b};s.each=s.forEach=function(a,b,c){b=t(b,c);var d,e;if(A(a))for(d=0,e=a.length;e>d;d++)b(a[d],d,a);else{var f=s.keys(a);for(d=0,e=f.length;e>d;d++)b(a[f[d]],f[d],a)}return a},s.map=s.collect=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=Array(e),g=0;e>g;g++){var h=d?d[g]:g;f[g]=b(a[h],h,a)}return f},s.reduce=s.foldl=s.inject=a(1),s.reduceRight=s.foldr=a(-1),s.find=s.detect=function(a,b,c){var d;return d=A(a)?s.findIndex(a,b,c):s.findKey(a,b,c),void 0!==d&&-1!==d?a[d]:void 0},s.filter=s.select=function(a,b,c){var d=[];return b=u(b,c),s.each(a,function(a,c,e){b(a,c,e)&&d.push(a)}),d},s.reject=function(a,b,c){return s.filter(a,s.negate(u(b)),c)},s.every=s.all=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(!b(a[g],g,a))return!1}return!0},s.some=s.any=function(a,b,c){b=u(b,c);for(var d=!A(a)&&s.keys(a),e=(d||a).length,f=0;e>f;f++){var g=d?d[f]:f;if(b(a[g],g,a))return!0}return!1},s.contains=s.includes=s.include=function(a,b,c,d){return A(a)||(a=s.values(a)),("number"!=typeof c||d)&&(c=0),s.indexOf(a,b,c)>=0},s.invoke=function(a,b){var c=k.call(arguments,2),d=s.isFunction(b);return s.map(a,function(a){var e=d?b:a[b];return null==e?e:e.apply(a,c)})},s.pluck=function(a,b){return s.map(a,s.property(b))},s.where=function(a,b){return s.filter(a,s.matcher(b))},s.findWhere=function(a,b){return s.find(a,s.matcher(b))},s.max=function(a,b,c){var d,e,f=-(1/0),g=-(1/0);if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],d>f&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(e>g||e===-(1/0)&&f===-(1/0))&&(f=a,g=e)});return f},s.min=function(a,b,c){var d,e,f=1/0,g=1/0;if(null==b&&null!=a){a=A(a)?a:s.values(a);for(var h=0,i=a.length;i>h;h++)d=a[h],f>d&&(f=d)}else b=u(b,c),s.each(a,function(a,c,d){e=b(a,c,d),(g>e||e===1/0&&f===1/0)&&(f=a,g=e)});return f},s.shuffle=function(a){for(var b,c=A(a)?a:s.values(a),d=c.length,e=Array(d),f=0;d>f;f++)b=s.random(0,f),b!==f&&(e[f]=e[b]),e[b]=c[f];return e},s.sample=function(a,b,c){return null==b||c?(A(a)||(a=s.values(a)),a[s.random(a.length-1)]):s.shuffle(a).slice(0,Math.max(0,b))},s.sortBy=function(a,b,c){return b=u(b,c),s.pluck(s.map(a,function(a,c,d){return{value:a,index:c,criteria:b(a,c,d)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var B=function(a){return function(b,c,d){var e={};return c=u(c,d),s.each(b,function(d,f){var g=c(d,f,b);a(e,d,g)}),e}};s.groupBy=B(function(a,b,c){s.has(a,c)?a[c].push(b):a[c]=[b]}),s.indexBy=B(function(a,b,c){a[c]=b}),s.countBy=B(function(a,b,c){s.has(a,c)?a[c]++:a[c]=1}),s.toArray=function(a){return a?s.isArray(a)?k.call(a):A(a)?s.map(a,s.identity):s.values(a):[]},s.size=function(a){return null==a?0:A(a)?a.length:s.keys(a).length},s.partition=function(a,b,c){b=u(b,c);var d=[],e=[];return s.each(a,function(a,c,f){(b(a,c,f)?d:e).push(a)}),[d,e]},s.first=s.head=s.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:s.initial(a,a.length-b)},s.initial=function(a,b,c){return k.call(a,0,Math.max(0,a.length-(null==b||c?1:b)))},s.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:s.rest(a,Math.max(0,a.length-b))},s.rest=s.tail=s.drop=function(a,b,c){return k.call(a,null==b||c?1:b)},s.compact=function(a){return s.filter(a,s.identity)};var C=function(a,b,c,d){for(var e=[],f=0,g=d||0,h=z(a);h>g;g++){var i=a[g];if(A(i)&&(s.isArray(i)||s.isArguments(i))){b||(i=C(i,b,c));var j=0,k=i.length;for(e.length+=k;k>j;)e[f++]=i[j++]}else c||(e[f++]=i)}return e};s.flatten=function(a,b){return C(a,b,!1)},s.without=function(a){return s.difference(a,k.call(arguments,1))},s.uniq=s.unique=function(a,b,c,d){s.isBoolean(b)||(d=c,c=b,b=!1),null!=c&&(c=u(c,d));for(var e=[],f=[],g=0,h=z(a);h>g;g++){var i=a[g],j=c?c(i,g,a):i;b?(g&&f===j||e.push(i),f=j):c?s.contains(f,j)||(f.push(j),e.push(i)):s.contains(e,i)||e.push(i)}return e},s.union=function(){return s.uniq(C(arguments,!0,!0))},s.intersection=function(a){for(var b=[],c=arguments.length,d=0,e=z(a);e>d;d++){var f=a[d];if(!s.contains(b,f)){for(var g=1;c>g&&s.contains(arguments[g],f);g++);g===c&&b.push(f)}}return b},s.difference=function(a){var b=C(arguments,!0,!0,1);return s.filter(a,function(a){return!s.contains(b,a)})},s.zip=function(){return s.unzip(arguments)},s.unzip=function(a){for(var b=a&&s.max(a,z).length||0,c=Array(b),d=0;b>d;d++)c[d]=s.pluck(a,d);return c},s.object=function(a,b){for(var c={},d=0,e=z(a);e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},s.findIndex=b(1),s.findLastIndex=b(-1),s.sortedIndex=function(a,b,c,d){c=u(c,d,1);for(var e=c(b),f=0,g=z(a);g>f;){var h=Math.floor((f+g)/2);c(a[h])<e?f=h+1:g=h}return f},s.indexOf=c(1,s.findIndex,s.sortedIndex),s.lastIndexOf=c(-1,s.findLastIndex),s.range=function(a,b,c){null==b&&(b=a||0,a=0),c=c||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=Array(d),f=0;d>f;f++,a+=c)e[f]=a;return e};var D=function(a,b,c,d,e){if(!(d instanceof b))return a.apply(c,e);var f=w(a.prototype),g=a.apply(f,e);return s.isObject(g)?g:f};s.bind=function(a,b){if(p&&a.bind===p)return p.apply(a,k.call(arguments,1));if(!s.isFunction(a))throw new TypeError("Bind must be called on a function");var c=k.call(arguments,2),d=function(){return D(a,d,b,this,c.concat(k.call(arguments)))};return d},s.partial=function(a){var b=k.call(arguments,1),c=function(){for(var d=0,e=b.length,f=Array(e),g=0;e>g;g++)f[g]=b[g]===s?arguments[d++]:b[g];for(;d<arguments.length;)f.push(arguments[d++]);return D(a,c,this,this,f)};return c},s.bindAll=function(a){var b,c,d=arguments.length;if(1>=d)throw new Error("bindAll must be passed function names");for(b=1;d>b;b++)c=arguments[b],a[c]=s.bind(a[c],a);return a},s.memoize=function(a,b){var c=function(d){var e=c.cache,f=""+(b?b.apply(this,arguments):d);return s.has(e,f)||(e[f]=a.apply(this,arguments)),e[f]};return c.cache={},c},s.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},s.defer=s.partial(s.delay,s,1),s.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:s.now(),g=null,f=a.apply(d,e),g||(d=e=null)};return function(){var j=s.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k||k>b?(g&&(clearTimeout(g),g=null),h=j,f=a.apply(d,e),g||(d=e=null)):g||c.trailing===!1||(g=setTimeout(i,k)),f}},s.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=s.now()-g;b>j&&j>=0?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=s.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},s.wrap=function(a,b){return s.partial(b,a)},s.negate=function(a){return function(){return!a.apply(this,arguments)}},s.compose=function(){var a=arguments,b=a.length-1;return function(){for(var c=b,d=a[b].apply(this,arguments);c--;)d=a[c].call(this,d);return d}},s.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},s.before=function(a,b){var c;return function(){return--a>0&&(c=b.apply(this,arguments)),1>=a&&(b=null),c}},s.once=s.partial(s.before,2);var E=!{toString:null}.propertyIsEnumerable("toString"),F=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];s.keys=function(a){if(!s.isObject(a))return[];if(o)return o(a);var b=[];for(var c in a)s.has(a,c)&&b.push(c);return E&&d(a,b),b},s.allKeys=function(a){if(!s.isObject(a))return[];var b=[];for(var c in a)b.push(c);return E&&d(a,b),b},s.values=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},s.mapObject=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=e.length,g={},h=0;f>h;h++)d=e[h],g[d]=b(a[d],d,a);return g},s.pairs=function(a){for(var b=s.keys(a),c=b.length,d=Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},s.invert=function(a){for(var b={},c=s.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},s.functions=s.methods=function(a){var b=[];for(var c in a)s.isFunction(a[c])&&b.push(c);return b.sort()},s.extend=v(s.allKeys),s.extendOwn=s.assign=v(s.keys),s.findKey=function(a,b,c){b=u(b,c);for(var d,e=s.keys(a),f=0,g=e.length;g>f;f++)if(d=e[f],b(a[d],d,a))return d},s.pick=function(a,b,c){var d,e,f={},g=a;if(null==g)return f;s.isFunction(b)?(e=s.allKeys(g),d=t(b,c)):(e=C(arguments,!1,!1,1),d=function(a,b,c){return b in c},g=Object(g));for(var h=0,i=e.length;i>h;h++){var j=e[h],k=g[j];d(k,j,g)&&(f[j]=k)}return f},s.omit=function(a,b,c){if(s.isFunction(b))b=s.negate(b);else{var d=s.map(C(arguments,!1,!1,1),String);b=function(a,b){return!s.contains(d,b)}}return s.pick(a,b,c)},s.defaults=v(s.allKeys,!0),s.create=function(a,b){var c=w(a);return b&&s.extendOwn(c,b),c},s.clone=function(a){return s.isObject(a)?s.isArray(a)?a.slice():s.extend({},a):a},s.tap=function(a,b){return b(a),a},s.isMatch=function(a,b){var c=s.keys(b),d=c.length;if(null==a)return!d;for(var e=Object(a),f=0;d>f;f++){var g=c[f];if(b[g]!==e[g]||!(g in e))return!1}return!0};var G=function(a,b,c,d){if(a===b)return 0!==a||1/a===1/b;if(null==a||null==b)return a===b;a instanceof s&&(a=a._wrapped),b instanceof s&&(b=b._wrapped);var e=l.call(a);if(e!==l.call(b))return!1;switch(e){case"[object RegExp]":case"[object String]":return""+a==""+b;case"[object Number]":return+a!==+a?+b!==+b:0===+a?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}var f="[object Array]"===e;if(!f){if("object"!=typeof a||"object"!=typeof b)return!1;var g=a.constructor,h=b.constructor;if(g!==h&&!(s.isFunction(g)&&g instanceof g&&s.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1}c=c||[],d=d||[];for(var i=c.length;i--;)if(c[i]===a)return d[i]===b;if(c.push(a),d.push(b),f){if(i=a.length,i!==b.length)return!1;for(;i--;)if(!G(a[i],b[i],c,d))return!1}else{var j,k=s.keys(a);if(i=k.length,s.keys(b).length!==i)return!1;for(;i--;)if(j=k[i],!s.has(b,j)||!G(a[j],b[j],c,d))return!1}return c.pop(),d.pop(),!0};s.isEqual=function(a,b){return G(a,b)},s.isEmpty=function(a){return null==a?!0:A(a)&&(s.isArray(a)||s.isString(a)||s.isArguments(a))?0===a.length:0===s.keys(a).length},s.isElement=function(a){return!(!a||1!==a.nodeType)},s.isArray=n||function(a){return"[object Array]"===l.call(a)},s.isObject=function(a){var b=typeof a;return"function"===b||"object"===b&&!!a},s.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(a){s["is"+a]=function(b){return l.call(b)==="[object "+a+"]"}}),s.isArguments(arguments)||(s.isArguments=function(a){return s.has(a,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(s.isFunction=function(a){return"function"==typeof a||!1}),s.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},s.isNaN=function(a){return s.isNumber(a)&&a!==+a},s.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"===l.call(a)},s.isNull=function(a){return null===a},s.isUndefined=function(a){return void 0===a},s.has=function(a,b){return null!=a&&m.call(a,b)},s.noConflict=function(){return e._=f,this},s.identity=function(a){return a},s.constant=function(a){return function(){return a}},s.noop=function(){},s.property=x,s.propertyOf=function(a){return null==a?function(){}:function(b){return a[b]}},s.matcher=s.matches=function(a){return a=s.extendOwn({},a),function(b){return s.isMatch(b,a)}},s.times=function(a,b,c){var d=Array(Math.max(0,a));b=t(b,c,1);for(var e=0;a>e;e++)d[e]=b(e);return d},s.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},s.now=Date.now||function(){return(new Date).getTime()};var H={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},I=s.invert(H),J=function(a){var b=function(b){return a[b]},c="(?:"+s.keys(a).join("|")+")",d=RegExp(c),e=RegExp(c,"g");return function(a){return a=null==a?"":""+a,d.test(a)?a.replace(e,b):a}};s.escape=J(H),s.unescape=J(I),s.result=function(a,b,c){var d=null==a?void 0:a[b];return void 0===d&&(d=c),s.isFunction(d)?d.call(a):d};var K=0;s.uniqueId=function(a){var b=++K+"";return a?a+b:b},s.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\u2028|\u2029/g,O=function(a){return"\\"+M[a]};s.template=function(a,b,c){!b&&c&&(b=c),b=s.defaults({},b,s.templateSettings);var d=RegExp([(b.escape||L).source,(b.interpolate||L).source,(b.evaluate||L).source].join("|")+"|$","g"),e=0,f="__p+='";a.replace(d,function(b,c,d,g,h){return f+=a.slice(e,h).replace(N,O),e=h+b.length,c?f+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'":d?f+="'+\n((__t=("+d+"))==null?'':__t)+\n'":g&&(f+="';\n"+g+"\n__p+='"),b}),f+="';\n",b.variable||(f="with(obj||{}){\n"+f+"}\n"),f="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+f+"return __p;\n";try{var g=new Function(b.variable||"obj","_",f)}catch(h){throw h.source=f,h}var i=function(a){return g.call(this,a,s)},j=b.variable||"obj";return i.source="function("+j+"){\n"+f+"}",i},s.chain=function(a){var b=s(a);return b._chain=!0,b};var P=function(a,b){return a._chain?s(b).chain():b};s.mixin=function(a){s.each(s.functions(a),function(b){var c=s[b]=a[b];s.prototype[b]=function(){var a=[this._wrapped];return j.apply(a,arguments),P(this,c.apply(s,a))}})},s.mixin(s),s.each(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=g[a];s.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!==a&&"splice"!==a||0!==c.length||delete c[0],P(this,c)}}),s.each(["concat","join","slice"],function(a){var b=g[a];s.prototype[a]=function(){return P(this,b.apply(this._wrapped,arguments))}}),s.prototype.value=function(){return this._wrapped},s.prototype.valueOf=s.prototype.toJSON=s.prototype.value,s.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return s})}).call(this),function(){function a(){}function b(){}function c(a,b){this._loggers={},this.name=a||"",this._parent=b||null,b||(this._enabled=!0,this._level=h.WARN)}function d(){return g}function e(a){g=a}Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});var f,g,h={DEBUG:10,INFO:20,WARN:30,ERROR:40,FATAL:50};a.prototype={output:function(a,b,c){if("undefined"!=typeof window.console&&"undefined"!=typeof console.log){a&&c.unshift(a+":");var d=c.join(" ");if(void 0===typeof console.info){var e;e=b<=h.DEBUG?"DEBUG":b<=h.INFO?"INFO":b<=h.WARN?"WARN":b<=h.ERROR?"ERROR":"FATAL",console.log("["+e+"] "+d)}else b<=h.DEBUG?(d="[DEBUG] "+d,console.log(d)):b<=h.INFO?console.info(d):b<=h.WARN?console.warn(d):console.error(d)}}},b.prototype={output:function(a,b,c){a&&c.unshift(a+":"),b<=h.DEBUG?(c.unshift("[DEBUG]"),console.log.apply(console,c)):b<=h.INFO?console.info.apply(console,c):b<=h.WARN?console.warn.apply(console,c):console.error.apply(console,c)}},c.prototype={getLogger:function(a){for(var b=a.split("."),d=this,e=this.name?[this.name]:[];b.length;){var f=b.shift();e.push(f),f in d._loggers||(d._loggers[f]=new c(e.join("."),d)),d=d._loggers[f]}return d},_getFlag:function(a){var b=this;for(a="_"+a;null!==b;){if(void 0!==b[a])return b[a];b=b._parent}return null},setEnabled:function(a){this._enabled=!!a},isEnabled:function(){this._getFlag("enabled")},setLevel:function(a){"number"==typeof a?this._level=a:"string"==typeof a&&(a=a.toUpperCase(),a in h&&(this._level=h[a]))},getLevel:function(){return this._getFlag("level")},log:function(a,b){!b.length||!this._getFlag("enabled")||a<this._getFlag("level")||(b=Array.prototype.slice.call(b),g.output(this.name,a,b))},debug:function(){this.log(h.DEBUG,arguments)},info:function(){this.log(h.INFO,arguments)},warn:function(){this.log(h.WARN,arguments)},error:function(){this.log(h.ERROR,arguments)},fatal:function(){this.log(h.FATAL,arguments)}},e(window.console&&window.console.log&&"function"==typeof window.console.log.apply?new b:new a),f=new c;for(var i,j=/loglevel(|-[^=]+)=([^&]+)/g;null!==(i=j.exec(window.location.search));){var k=""===i[1]?f:f.getLogger(i[1].slice(1));k.setLevel(i[2].toUpperCase())}var l={Level:h,getLogger:f.getLogger.bind(f),setEnabled:f.setEnabled.bind(f),isEnabled:f.isEnabled.bind(f),setLevel:f.setLevel.bind(f),getLevel:f.getLevel.bind(f),debug:f.debug.bind(f),info:f.info.bind(f),warn:f.warn.bind(f),error:f.error.bind(f),fatal:f.fatal.bind(f),getWriter:d,setWriter:e};"function"==typeof define?define("logging",[],function(){return l}):window.logging=l}(),define("pat-logger",["logging"],function(a){var b=a.getLogger("patterns");return b}),define("pat-utils",["jquery"],function(a){function b(a,b){var c;return function(){var d=this,e=arguments,f=function(){c=null,a.apply(d,e)};clearTimeout(c),c=setTimeout(f,b)}}function c(a){var b=typeof a;return"function"===b||"object"===b&&!!a}function d(a){if(!c(a))return a;for(var b,d,e=1,f=arguments.length;f>e;e++){b=arguments[e];for(d in b)hasOwnProperty.call(b,d)&&(a[d]=b[d])}return a}function e(a,b){return-1!==b.indexOf("://")||"/"===b[0]?b:a.slice(0,a.lastIndexOf("/")+1)+b}function f(b){for(var c,d=b.parentNode;d&&11!==d.nodeType;d=d.parentNode)if("LABEL"===d.tagName)return d;return b.id&&(c=a('label[for="'+b.id+'"]')),c&&0===c.length&&b.form&&(c=a('label[for="'+b.name+'"]',b.form)),c&&c.length?c[0]:null}function g(a){var b=a.getBoundingClientRect(),c=document.documentElement,d=window.innerWidth||c.clientWidth,e=window.innerHeight||c.clientHeight;return b.right<0||b.bottom<0||b.left>d||b.top>e?!1:!0}function h(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function i(b,c){if(-1===c.indexOf("*"))b.removeClass(c);else{var d=c.replace(/[\-\[\]{}()+?.,\\\^$|#\s]/g,"\\$&");d=d.replace(/[*]/g,".*"),d=new RegExp("^"+d+"$"),b.filter("[class]").each(function(){for(var b=a(this),c=b.attr("class").split(/\s+/),e=[],f=0;f<c.length;f++)d.test(c[f])||e.push(c[f]);e.length?b.attr("class",e.join(" ")):b.removeAttr("class")})}}function j(a,b,c,d){var e="css"===c.transition||"none"===c.transition?null:c.effect.duration;a.removeClass("visible hidden in-progress");var f=function(){a.removeClass("in-progress").addClass(b?"visible":"hidden").trigger("pat-update",{pattern:d,transition:"complete"})};if(e){var g=o[c.transition];a.addClass("in-progress").trigger("pat-update",{pattern:d,transition:"start"}),a[b?g.show:g.hide]({duration:e,easing:c.effect.easing,complete:f})}else"css"!==c.transition&&a[b?"show":"hide"](),f()}function k(a,b,c){var d=new RegExp("(\\?|\\&)"+b+"=.*?(?=(&|$))"),e=a.toString().split("#"),f=e[0],g=e[1],h=/\?.+$/,i=f;return i=d.test(f)?f.replace(d,"$1"+b+"="+c):h.test(f)?f+"&"+b+"="+c:f+"?"+b+"="+c,g&&(i+="#"+g),i}a.fn.safeClone=function(){var b=this.clone();return void 0!==a.browser.msie&&b.findInclusive(":input[placeholder]").each(function(b,c){var d=a(c);d.attr("placeholder")===d.val()&&d.val("")}),b},Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null===this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}});var l=function(b,c,d){var e=this;return e.each(function(){var e,f=a(this);if(e=b.init(f,d),c){if(void 0===e[c])return a.error("Method "+c+" does not exist on jQuery."+b.name),!1;if("_"===c.charAt(0))return a.error("Method "+c+" is private on jQuery."+b.name),!1;e[c].apply(e,[d])}}),e},m=function(b,c,d){var e=this;if(c){if(b[c])return b[c].apply(e,[e].concat([d]));a.error("Method "+c+" does not exist on jQuery."+b.name)}else b.init.apply(e,[e].concat([d]));return e},n=function(a){return function(b,c){var d=this;return 0===d.length?d:("object"==typeof b&&(c=b,b=void 0),"function"==typeof a?l.call(this,a,b,c):m.call(this,a,b,c))}},o={none:{hide:"hide",show:"show"},fade:{hide:"fadeOut",show:"fadeIn"},slide:{hide:"slideUp",show:"slideDown"}},p={jqueryPlugin:n,debounce:b,escapeRegExp:h,isObject:c,extend:d,rebaseURL:e,findLabel:f,elementInViewport:g,removeWildcardClass:i,hideOrShow:j,addURLQueryParameter:k};return p}),define("pat-compat",[],function(){Array.prototype.every||(Array.prototype.every=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments[1],e=0;c>e;e++)if(e in b&&!a.call(d,b[e],e,b))return!1;return!0}),Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments[1],f=0;c>f;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null===this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("[object Function]"!=={}.toString.call(a))throw new TypeError(a+" is not a function");for(b&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=0;if(arguments.length>0&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==1/0&&d!==-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d)))),d>=c)return-1;for(var e=d>=0?d:Math.max(c-Math.abs(d),0);c>e;e++)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.lastIndexOf||(Array.prototype.lastIndexOf=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if(0===c)return-1;var d=c;arguments.length>1&&(d=Number(arguments[1]),d!==d?d=0:0!==d&&d!==1/0&&d!==-(1/0)&&(d=(d>0||-1)*Math.floor(Math.abs(d))));for(var e=d>=0?Math.min(d,c-1):c-Math.abs(d);e>=0;e--)if(e in b&&b[e]===a)return e;return-1}),Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(null===this)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if("[object Function]"!=={}.toString.call(a))throw new TypeError(a+" is not a function");for(b&&(c=b),d=new Array(g),e=0;g>e;){var h,i;e in f&&(h=f[e],i=a.call(c,h,e,f),d[e]=i),e++}return d}),Array.prototype.reduce||(Array.prototype.reduce=function(a){if(null===this||void 0===this)throw new TypeError("Object is null or undefined");var b,c=0,d=this.length>>0;if("function"!=typeof a)throw new TypeError("First argument is not callable");if(arguments.length<2){if(0===d)throw new TypeError("Array length is 0 and no second argument");b=this[0],c=1}else b=arguments[1];for(;d>c;)c in this&&(b=a.call(void 0,b,this[c],c,this)),++c;return b}),Array.prototype.reduceRight||(Array.prototype.reduceRight=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;if(0===c&&1===arguments.length)throw new TypeError;var d,e=c-1;if(arguments.length>=2)d=arguments[1];else for(;;){if(e in this){d=this[e--];break}if(--e<0)throw new TypeError}for(;e>=0;)e in b&&(d=a.call(void 0,d,b[e],e,b)),e--;return d}),Array.prototype.some||(Array.prototype.some=function(a){"use strict";if(null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=arguments[1],e=0;c>e;e++)if(e in b&&a.call(d,b[e],e,b))return!0;return!1}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e}),Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],d=c.length;return function(e){if("object"!=typeof e&&"function"!=typeof e||null===e)throw new TypeError("Object.keys called on non-object");var f=[];for(var g in e)a.call(e,g)&&f.push(g);if(b)for(var h=0;d>h;h++)a.call(e,c[h])&&f.push(c[h]);return f}}())}),define("pat-jquery-ext",["jquery"],function(a){var b={init:function(c){var d={time:3,initialTime:8,exceptionAreas:[]};return this.each(function(){var e=a(this),f=e.data("timeout");f||(c&&a.extend(d,c),e.data("timeout",{lastEvent:new Date,trueTime:d.time,time:d.initialTime,untouched:!0,inExceptionArea:!1}),e.bind("mouseover.timeout",b.mouseMoved),e.bind("mouseenter.timeout",b.mouseMoved),a(d.exceptionAreas).each(function(){e.find(this).live("mouseover.timeout",{parent:e},b.enteredException).live("mouseleave.timeout",{parent:e},b.leftException)}),d.initialTime>0?e.timeout("startTimer"):e.addClass("timeout"))})},enteredException:function(a){var b=a.data.parent.data("timeout");b.inExceptionArea=!0,a.data.parent.data("timeout",b),a.data.parent.trigger("mouseover")},leftException:function(a){var b=a.data.parent.data("timeout");b.inExceptionArea=!1,a.data.parent.data("timeout",b)},destroy:function(){return this.each(function(){var b=a(this),c=b.data("timeout");a(window).unbind(".timeout"),c.timeout.remove(),b.removeData("timeout")})},mouseMoved:function(){var b=a(this),c=b.data("timeout");b.hasClass("timeout")?(b.removeClass("timeout"),b.timeout("startTimer")):c.untouched&&(c.untouched=!1,c.time=c.trueTime),c.lastEvent=new Date,b.data("timeout",c)},startTimer:function(){var b=a(this),c=b.data("timeout"),d=function(){var a=b.data("timeout");if(a&&a.lastEvent)if(a.inExceptionArea)setTimeout(d,Math.floor(1e3*a.time));else{var c=new Date,e=Math.floor(1e3*a.time)-(c-a.lastEvent);e>0?setTimeout(d,e+100):b.addClass("timeout")}};setTimeout(d,Math.floor(1e3*c.time))}};a.fn.timeout=function(c){return b[c]?b[c].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof c&&c?void a.error("Method "+c+" does not exist on jQuery.timeout"):b.init.apply(this,arguments)},a.extend(a.expr[":"],{scrollable:function(b){var c,d;return"scroll"===a(b).css("overflow")||"scroll"===a(b).css("overflowX")||"scroll"===a(b).css("overflowY")?!0:(c=b.clientHeight<b.scrollHeight&&(-1!==a.inArray(a(b).css("overflowY"),["scroll","auto"])||-1!==a.inArray(a(b).css("overflow"),["scroll","auto"])))?!0:d=b.clientWidth<b.scrollWidth&&(-1!==a.inArray(a(b).css("overflowX"),["scroll","auto"])||-1!==a.inArray(a(b).css("overflow"),["scroll","auto"]))}}),a.fn.makeVisibleInScroll=function(b){var c=null;return"string"==typeof b?c=a("#"+b):b&&(c=a(b)),this.each(function(){var b,d=a(this);c?b=c:(b=d.parents(":scrollable"),b=a(b.length>0?b[0]:window));var e=d.position().top,f=d.height()+e,g=b.scrollTop(),h=b.height()+g;g>e?b.scrollTop(e):f>h-b.height()/2&&b.scrollTop(e-(b.height()-d.height())/2)})},a.fn.setPositionAbsolute=function(b,c,d){return this.each(function(){var e=a(this),f=a(this).width(),g=b.offset(),h=b.width(),i=b.height(),j=g.left+h-f+d,k=g.top+i+c;e.css({"z-index":1,position:"absolute",marginLeft:0,marginTop:0,left:j+"px",top:k+"px",width:f}),e.remove().appendTo("body").show()})},a.fn.positionAncestor=function(b){var c=0,d=0;return this.each(function(){var e=a(this).closest(b);if(e.length&&"static"!==e.css("position")){var f=a(this),g=f.offset().left-parseInt(f.css("marginLeft"),10),h=f.offset().top-parseInt(f.css("marginTop"),10),i=e.offset().left+parseInt(e.css("borderLeftWidth"),10),j=e.offset().top+parseInt(e.css("borderTopWidth"),10);return c=g-i,d=h-j,!1}}),{left:c,top:d}},String.prototype.startsWith=function(a){return null!==this.match("^"+a)},String.prototype.endsWith=function(a){return null!==this.match(a+"$")},a.simplePlaceholder={placeholder_class:null,hide_placeholder:function(){var b=a(this);b.val()===b.attr("placeholder")&&b.val("").removeClass(a.simplePlaceholder.placeholder_class)},show_placeholder:function(){var b=a(this);""===b.val()&&b.val(b.attr("placeholder")).addClass(a.simplePlaceholder.placeholder_class)},prevent_placeholder_submit:function(){return a(this).find(".simple-placeholder").each(function(){var b=a(this);b.val()===b.attr("placeholder")&&b.val("")}),!0}},a.fn.simplePlaceholder=function(b){if(void 0===document.createElement("input").placeholder){var c={placeholder_class:"placeholding"};b&&a.extend(c,b),a.simplePlaceholder.placeholder_class=c.placeholder_class,this.each(function(){var b=a(this);b.focus(a.simplePlaceholder.hide_placeholder),b.blur(a.simplePlaceholder.show_placeholder),""===b.val()&&(b.val(b.attr("placeholder")),b.addClass(a.simplePlaceholder.placeholder_class)),b.addClass("simple-placeholder"),a(this.form).submit(a.simplePlaceholder.prevent_placeholder_submit)})}return this},a.fn.findInclusive=function(a){return this.find("*").addBack().filter(a)},a.fn.slideIn=function(a,b,c){return this.animate({width:"show"},a,b,c)},a.fn.slideOut=function(a,b,c){return this.animate({width:"hide"},a,b,c)},a.expr[":"].Contains=function(b,c,d){return a(b).text().toUpperCase().indexOf(d[3].toUpperCase())>=0},a.fn.scopedFind=function(b){return b.startsWith("#")?a(b):this.find(b)}}),define("pat-registry",["jquery","underscore","pat-logger","pat-utils","pat-compat","pat-jquery-ext"],function(a,b,c,d){
for(var e,f=3,g=8,h=c.getLogger("registry"),i=/patterns-disable=([^&]+)/g,j=/patterns-dont-catch/g,k=!1,l={};null!==(e=i.exec(window.location.search));)l[e[1]]=!0,h.info("Pattern disabled via url config:",e[1]);for(;null!==(e=j.exec(window.location.search));)k=!0,h.info("I will not catch init exceptions");var m={patterns:{},initialized:!1,init:function(){a(document).ready(function(){h.info("loaded: "+Object.keys(m.patterns).sort().join(", ")),m.scan(document.body),m.initialized=!0,h.info("finished initial scan.")})},clear:function(){this.patterns={}},transformPattern:function(b,c){if(l[b])return void h.debug("Skipping disabled pattern:",b);var d=m.patterns[b];if(d.transform)try{d.transform(a(c))}catch(e){if(k)throw e;h.error("Transform error for pattern"+b,e)}},initPattern:function(b,d,e){var f=a(d),g=m.patterns[b];if(g.init&&(plog=c.getLogger("pat."+b),f.is(g.trigger))){plog.debug("Initialising:",f);try{g.init(f,null,e),plog.debug("done.")}catch(h){if(k)throw h;plog.error("Caught error:",h)}}},orderPatterns:function(a){return b.contains(a,"validation")&&b.contains(a,"inject")&&(a.splice(a.indexOf("validation"),1),a.unshift("validation")),a},scan:function(c,d,e){var f,g=[];d=this.orderPatterns(d||Object.keys(m.patterns)),d.forEach(b.partial(this.transformPattern,b,c)),d=b.each(d,function(a){var b=m.patterns[a];b.trigger&&g.unshift(b.trigger)}),f=a(c).findInclusive(g.join(",")),f=f.filter(function(){return 0===a(this).parents("pre").length}),f=f.filter(":not(.cant-touch-this)"),f.toArray().reduceRight(function(a,c){d.forEach(b.partial(this.initPattern,b,c,e))}.bind(this),null),a("body").addClass("patterns-loaded")},register:function(b,c){var e;return(c=c||b.name)?m.patterns[c]?(h.error("Already have a pattern called: "+c),!1):(m.patterns[c]=b,b.jquery_plugin&&(e=("pat-"+c).replace(/-([a-zA-Z])/g,function(a,b){return b.toUpperCase()}),a.fn[e]=d.jqueryPlugin(b),a.fn[e.replace(/^pat/,"pattern")]=a.fn[e]),h.debug("Registered pattern:",c,b),m.initialized&&m.scan(document.body,[c]),!0):(h.error("Pattern lacks a name:",b),!1)}};return a(document).on("patterns-injected.patterns",function(b,c,d,e){e.nodeType!==f&&e!==g&&(m.scan(e,null,{type:"injection",element:d}),a(e).trigger("patterns-injected-scanned"))}),m}),define("pat-mockup-parser",["jquery"],function(a){"use strict";var b={getOptions:function c(b,d,e){e=e||{},0===b.length||a.nodeName(b[0],"body")||(e=c(b.parent(),d,e));var f={};if(0!==b.length&&(f=b.data("pat-"+d),f&&"string"==typeof f)){var g={};a.each(f.split(";"),function(a,b){b=b.split(":"),b.reverse();var c=b.pop();c=c.replace(/^\s+|\s+$/g,""),b.reverse();var d=b.join(":");d=d.replace(/^\s+|\s+$/g,""),g[c]=d}),f=g}return a.extend(!0,{},e,f)}};return b}),define("pat-base",["jquery","pat-registry","pat-mockup-parser","pat-logger"],function(a,b,c,d){"use strict";var e=d.getLogger("Patternslib Base"),f=function(a,e,f){var g=this.prototype.name,h=d.getLogger("pat."+g),i=a.data("pattern-"+g);if(void 0===i&&b.patterns[g]){try{e="mockup"===this.prototype.parser?c.getOptions(a,g,e):e,i=new b.patterns[g](a,e,f)}catch(j){h.error("Failed while initializing '"+g+"' pattern.",j)}a.data("pattern-"+g,i)}return i},g=function(b,c,d){this.$el=b,this.options=a.extend(!0,{},this.defaults||{},c||{}),this.init(b,c,d),this.emit("init")};return g.prototype={constructor:g,on:function(a,b){this.$el.on(a+"."+this.name+".patterns",b)},emit:function(a,b){void 0===b&&(b=[]),this.$el.trigger(a+"."+this.name+".patterns",b)}},g.extend=function(c){var d,h=this;if(!c)throw new Error("Pattern configuration properties required when calling Base.extend");d=c.hasOwnProperty("constructor")?c.constructor:function(){h.apply(this,arguments)},d.extend=g.extend,d.init=f,d.jquery_plugin=!0,d.trigger=c.trigger;var i=function(){this.constructor=d};return i.prototype=h.prototype,d.prototype=new i,a.extend(!0,d.prototype,c),d.__super__=h.prototype,c.name?c.trigger?b.register(d,c.name):e.warn("The pattern '"+c.name+"' does not have a trigger attribute, it will not be registered."):e.warn("This pattern without a name attribute will not be registered!"),d},g}),define("mockup-patterns-base",["jquery","pat-base"],function(a,b){"use strict";var c=function(){return b.apply(this,arguments)};for(var d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c.prototype=b.prototype,c.prototype.constructor=c,c.extend=function(){console.log("Usage of the mockup-patterns-base pattern is deprecated and it will eventually be removed.Instead, use pat-base and explicitly set parser to 'mockup' when calling extend.");var a=b.extend.apply(this,arguments);return a.prototype.parser="mockup",a},c}),define("mockup-utils",["jquery"],function(a){"use strict";var b=function(b){var c=this,d={pattern:null,vocabularyUrl:null,searchParam:"SearchableText",attributes:["UID","Title","Description","getURL","portal_type"],batchSize:10,baseCriteria:[],sort_on:"is_folderish",sort_order:"reverse",pathDepth:1};return c.options=a.extend({},d,b),c.pattern=c.options.pattern,(void 0===c.pattern||null===c.pattern)&&(c.pattern={browsing:!1,basePath:"/"}),c.options.url&&!c.options.vocabularyUrl?c.options.vocabularyUrl=c.options.url:c.pattern.vocabularyUrl&&(c.options.vocabularyUrl=c.pattern.vocabularyUrl),void 0!==c.options.vocabularyUrl&&null!==c.options.vocabularyUrl?c.valid=!0:c.valid=!1,c.getCurrentPath=function(){var a,b=c.pattern;a=c.currentPath?c.currentPath:b.currentPath,"function"==typeof a&&(a=a());var d=a;return d||(d=b.basePath?b.basePath:b.options.basePath?b.options.basePath:"/"),d},c.getCriterias=function(b,d){void 0===d&&(d={}),d=a.extend({},{useBaseCriteria:!0,additionalCriterias:[]},d);var e=[];return d.useBaseCriteria&&(e=c.options.baseCriteria.slice(0)),b&&(b+="*",e.push({i:c.options.searchParam,o:"plone.app.querystring.operation.string.contains",v:b})),d.searchPath?e.push({i:"path",o:"plone.app.querystring.operation.string.path",v:d.searchPath+"::"+c.options.pathDepth}):c.pattern.browsing&&e.push({i:"path",o:"plone.app.querystring.operation.string.path",v:c.getCurrentPath()+"::"+c.options.pathDepth}),e=e.concat(d.additionalCriterias)},c.getBatch=function(a){return a||(a=1),{page:a,size:c.options.batchSize}},c.selectAjax=function(){return{url:c.options.vocabularyUrl,dataType:"JSON",quietMillis:100,data:function(a,b){return c.getQueryData(a,b)},results:function(a,b){var c=10*b<a.total;return{results:a.results,more:c}}}},c.getUrl=function(){var b=c.options.vocabularyUrl;return b+=-1===b.indexOf("?")?"?":"&",b+a.param(c.getQueryData())},c.getQueryData=function(a,b){var d={query:JSON.stringify({criteria:c.getCriterias(a),sort_on:c.options.sort_on,sort_order:c.options.sort_order}),attributes:JSON.stringify(c.options.attributes)};return b&&(d.batch=JSON.stringify(c.getBatch(b))),d},c.search=function(b,d,e,f,g,h){void 0===g&&(g=!0),void 0===h&&(h="GET");var i=[];g&&(i=c.options.baseCriteria.slice(0)),i.push({i:b,o:d,v:e});var j={query:JSON.stringify({criteria:i}),attributes:JSON.stringify(c.options.attributes)};a.ajax({url:c.options.vocabularyUrl,dataType:"JSON",data:j,type:h,success:f})},c},c=function(b){var c=this;c.className="plone-loader";var d={backdrop:null,zIndex:10005};return b||(b={}),c.options=a.extend({},d,b),c.init=function(){c.$el=a("."+c.className),0===c.$el.length&&(c.$el=a("<div><div></div></div>"),c.$el.addClass(c.className).hide().appendTo("body"))},c.show=function(b){c.init(),c.$el.show();var d=c.options.zIndex;"function"==typeof d?d=Math.max(d(),10005):(d=10005,a(".plone-modal-wrapper,.plone-modal-backdrop").each(function(){d=Math.max(d,a(this).css("zIndex")||10005)}),d+=1),c.$el.css("zIndex",d),void 0===b&&(b=!0),c.options.backdrop&&(c.options.backdrop.closeOnClick=b,c.options.backdrop.closeOnEsc=b,c.options.backdrop.init(),c.options.backdrop.show())},c.hide=function(){c.init(),c.$el.hide()},c},d=function(a){return void 0===a&&(a="id"),a+Math.floor(65536*(1+Math.random())).toString(16).substring(1)};return{generateId:d,parseBodyTag:function(b){return a(/<body[^>]*>((.|[\n\r])*)<\/body>/im.exec(b)[0].replace("<body","<div").replace("</body>","</div>")).eq(0).html()},setId:function(a,b){void 0===b&&(b="id");var c=a.attr("id");return c=void 0===c?d(b):c.replace(/\./g,"-"),a.attr("id",c),c},bool:function(b){return"string"==typeof b&&(b=a.trim(b).toLowerCase()),-1!==["true",!0,1].indexOf(b)},QueryHelper:b,Loading:c,loading:new c,getAuthenticator:function(){var b=a('input[name="_authenticator"]');return 0===b.length?(b=a('a[href*="_authenticator"]'),b.length>0?b.attr("href").split("_authenticator=")[1]:""):b.val()},featureSupport:{dragAndDrop:function(){return"draggable"in document.createElement("span")},fileApi:function(){return"undefined"!=typeof FileReader},history:function(){return!(!window.history||!window.history.pushState)}}}}),define("mosaic-url/mosaic.tile",["jquery","pat-logger","underscore","mockup-utils","pat-registry"],function(a,b,c,d,e){"use strict";var f=b.getLogger("pat-mosaic"),g=function(b){var c=this;c.$el=a(b),c.$el.is(".mosaic-tile")||(c.$el=c.$el.parents(".mosaic-tile")),c.$el.children(".mosaic-tile-content").off("blur").on("blur",function(){var b=c.getType();if("plone.app.standardtiles.rawhtml"===b){var e=c.getEditUrl();e&&a.ajax({url:e,method:"POST",data:{"plone.app.standardtiles.rawhtml.content":c.$el.children(".mosaic-tile-content").html(),_authenticator:d.getAuthenticator(),"buttons.save":"Save"}})}})};return g.prototype.getEditUrl=function(){var b=this.getUrl();return(b=b.replace(/@@/,"@@edit-tile/"))?(b.match(/^\.\/.*/)&&(b=a.mosaic.options.context_url+b.replace(/^\./,"")),b):void 0},g.prototype.getUrl=function(){var b=this.$el.find(".tileUrl").html();if(!b){var c=this.$el.find("[data-tileUrl]");c.size()>0&&(b=c.attr("data-tileUrl"))}return b||(b=this.$el.find("[data-tile]").attr("data-tile")),b&&(b=b.replace(a.mosaic.options.context_url,"./"),b=b.replace(/^\.\/\//,"./"),a.mosaic.hasContentLayout?-1===b.indexOf("X-Tile-Persistent")&&(b+=-1===b.indexOf("?")?"?":"&",b+="X-Tile-Persistent=yes"):-1!==b.indexOf("X-Tile-Persistent")&&(b=b.replace("X-Tile-Persistent=yes","").replace("&&","&"))),b},g.prototype.getType=function(){var b="",c=this.$el,d=c.attr("class"),e=[];return d&&(e=c.attr("class").split(" "),a(e).each(function(){var a;a=this.match(/^mosaic-([\w.\-]+)-tile$/),null!==a&&"selected"!==a[1]&&"new"!==a[1]&&"read-only"!==a[1]&&"helper"!==a[1]&&"original"!==a[1]&&(b=a[1])})),b||f.error("Could not find tile type on element with classes: "+e.join(", ")),b},g.prototype.getConfig=function(){for(var b,c=this.getType(),d=0;d<a.mosaic.options.tiles.length;d+=1){for(var e=!1,g=a.mosaic.options.tiles[d],h=0;h<g.tiles.length;h+=1){if("field"===g.tiles[h].tile_type){var i=g.tiles[h].widget.split(".");switch(i=i[i.length-1]){case"TextWidget":case"TextFieldWidget":case"TextAreaWidget":case"TextAreaFieldWidget":case"TextLinesWidget":case"TextLinesFieldWidget":case"WysiwygWidget":case"WysiwygFieldWidget":case"RichTextWidget":case"RichTextFieldWidget":g.tiles[h].settings=!1;break;default:g.tiles[h].settings=!0}}if(g.tiles[h].name===c){b=g.tiles[h],e=!0;break}}if(e)break}return b?b:void f.error("Could not load tile config for tile type: "+c)},g.prototype.getHtmlBody=function(){var b="",c="",d=this.$el.attr("class").split(" ");c=this.getType(),d=a(d).filter(function(){switch(this){case"mosaic-new-tile":case"mosaic-helper-tile":case"mosaic-original-tile":case"mosaic-selected-tile":return!1;default:return!0}}).toArray();var e=this.getConfig();switch(e.tile_type){case"text":b+='          <div class="'+d.join(" ")+'">\n',b+='          <div class="mosaic-tile-content">\n',b+=this.$el.children(".mosaic-tile-content").html().replace(/^\s+|\s+$/g,"")+"\n",b+="          </div>\n",b+="          </div>\n";break;case"app":b+='          <div class="'+d.join(" ")+'">\n',b+='          <div class="mosaic-tile-content">\n',b+='          <div data-tile="'+this.getUrl()+'"></div>\n',b+="          </div>\n",b+="          </div>\n";break;case"field":b+='          <div class="'+d.join(" ")+'">\n',b+='          <div class="mosaic-tile-content">\n';var f="./@@plone.app.standardtiles.field?field="+c;b+='          <div data-tile="'+f+'"></div>\n',b+="          </div>\n",b+="          </div>\n",this.saveForm()}return b},g.prototype.isRichText=function(a){return void 0===a&&(a=this.getConfig()),a&&this.$el.hasClass("mosaic-read-only-tile")===!1&&!this.$el.hasClass("mosaic-tile-loading")&&("text"===a.tile_type&&a.rich_text||"app"===a.tile_type&&a.rich_text||"field"===a.tile_type&&a.read_only===!1&&("z3c.form.browser.text.TextWidget"===a.widget||"z3c.form.browser.text.TextFieldWidget"===a.widget||"z3c.form.browser.textarea.TextAreaWidget"===a.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===a.widget||"z3c.form.browser.textlines.TextLinesWidget"===a.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===a.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===a.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===a.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===a.widget||"plone.app.widgets.dx.RichTextWidget"===a.widget))?!0:!1},g.prototype.initialize=function(){var b=this.getConfig();b&&b.read_only&&this.$el.addClass("mosaic-read-only-tile"),this.isRichText()&&this.setupWysiwyg(),this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-inner-border"))),b&&this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-tile-label").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-label-content").html(b.label)).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-label-left"))),this.makeMovable(),b&&b.settings&&this.$el.hasClass("mosaic-read-only-tile")===!1&&this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-info-icon"));var d=this;c.each(["top","bottom","right","left"],function(b){d.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider mosaic-divider-"+b).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot")))})},g.prototype.makeMovable=function(){this.$el.hasClass("movable")&&a.mosaic.options.canChangeLayout&&!a.mosaic.hasContentLayout&&this.$el.prepend(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-control mosaic-drag-handle"))},g.prototype.initializeContent=function(){var b,c,d,e,f,g=this,h=a("body",a.mosaic.document).attr("data-base-url");h||(h=a("head > base",a.mosaic.document).attr("href"));var i=this.getUrl(),j=this.getConfig();if(j)if("field"===j.tile_type){switch(e="","IDublinCore-title"===j.name?(c='<h1 class="documentFirstHeading">',d="</h1>"):"IDublinCore-description"===j.name?(c='<p class="documentDescription">',d="</p>"):(c="<div>",d="</div>"),j.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":e=c+a("#"+j.id).find("input").attr("value")+d;break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":f=a("#"+j.id).find("textarea").val().split("\n"),e+=c;for(var k=0;k<f.length;k+=1)e+=f[k]+"<br/>";e+=d;break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":e=a("#"+j.id).find("textarea").val();break;default:e='<div class="discreet">Placeholder for field:<br/><b>'+j.label+"</b></div>"}g.fillContent(e)}else j&&(g.$el.addClass("mosaic-tile-loading"),b=h?[h,i].join("/").replace(/\/+\.\//g,"/"):i,a.ajax({type:"GET",url:b,success:function(c){g.$el.removeClass("mosaic-tile-loading"),c=a.mosaic.getDomTreeFromHtml(c),a.mosaic.addHeadTags(i,c);var d=c.find(".temp_body_tag").html();g.fillContent(d,b);var e=g.getType();"plone.app.standardtiles.rawhtml"===e&&g.setupWysiwyg()},error:function(){g.$el.removeClass("mosaic-tile-loading")}}))},g.prototype.fillContent=function(a,b){var c=this.$el.find("[data-tile]").parent();c.html(a),e.scan(c);var d=this.$el.children(".mosaic-tile-content");b&&d.size()>0&&d.attr("data-tileUrl",b.replace(/&/gim,"&amp;"))},g.prototype.select=function(){if(this.$el.hasClass("mosaic-selected-tile")===!1&&this.$el.hasClass("mosaic-read-only-tile")===!1){var b=a(".mosaic-selected-tile",a.mosaic.document);if(1===b.size()){var c=new g(b);c.blur()}this.$el.addClass("mosaic-selected-tile"),this.focus()}},g.prototype._change=function(){a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.options.panels.mosaicSetResizeHandleLocation(),this.saveForm()},g.prototype.blur=function(){this.$el.removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),this._change()},g.prototype.focus=function(){this.$el.children(".mosaic-tile-content").focus(),this._change()},g.prototype.saveForm=function(){var b,c,d,e,f=this.getType(),g=this.getConfig();if(g&&"field"===g.tile_type&&g.read_only===!1&&("z3c.form.browser.text.TextWidget"===g.widget||"z3c.form.browser.text.TextFieldWidget"===g.widget||"z3c.form.browser.textarea.TextAreaWidget"===g.widget||"z3c.form.browser.textarea.TextAreaFieldWidget"===g.widget||"z3c.form.browser.textlines.TextLinesWidget"===g.widget||"z3c.form.browser.textlines.TextLinesFieldWidget"===g.widget||"plone.app.z3cform.widget.RichTextFieldWidget"===g.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygWidget"===g.widget||"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget"===g.widget||"plone.app.widgets.dx.RichTextWidget"===g.widget))switch(g.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":var h=a(".mosaic-panel .mosaic-"+f+"-tile",a.mosaic.document);h.size()>1&&(h=h.filter(function(){return a(".mosaic-tile-control",this).length>0}));var i=h.find(".mosaic-tile-content > *").text();a("#"+g.id).find("input").attr("value",i);break;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":d="",e="IDublinCore-description"===g.name?" ":"\n",a(".mosaic-panel .mosaic-"+f+"-tile",a.mosaic.document).find(".mosaic-tile-content > *").each(function(){d+=a(this).html().replace(/<br[^>]*>/gi,e).replace(/^\s+|\s+$/g,"")+e}),d=d.replace(/^\s+|\s+$/g,""),a("#"+g.id).find("textarea").val(d);break;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":b=a(document.getElementById(g.id)).find("textarea").attr("id"),c=window.tinymce.get(b),c&&(c.setContent(a(".mosaic-"+f+"-tile",a.mosaic.document).find(".mosaic-tile-content").html()),a(document.getElementById(g.id)).find("textarea").val(c.getContent()))}},g.prototype.setupWysiwyg=function(){var b,c=this.$el.find(".mosaic-tile-content");try{c.data("pattern-tinymce").destroy(),c.removeData("pattern-tinymce")}catch(d){}for(var e=1+Math.floor(1e5*Math.random());a("#mosaic-rich-text-init-"+e,a.mosaic.document).length>0;)e=1+Math.floor(1e5*Math.random());var f="mosaic-rich-text-init-"+e;c.attr("id",f),c.siblings(".mosaic-rich-text-toolbar").remove(),c.before(a('<div class="mosaic-rich-text-toolbar"></div>').attr("id",c.attr("id")+"-panel"));var h,i,j,k,l,m,n=this.getType();for(h=a.mosaic.options.default_available_actions,j=0;j<a.mosaic.options.tiles.length;j+=1)for(i=a.mosaic.options.tiles[j],k=0;k<i.tiles.length;k+=1)i.tiles[k].name===n&&(h=h.concat(i.tiles[k].available_actions));for(l=[],j=0;j<a.mosaic.options.richtext_toolbar.length;j+=1){for(i=a.mosaic.options.richtext_toolbar[j],k=0;k<i.actions.length;k+=1)a.inArray(i.actions[k].name,h)>-1&&l.push(i.actions[k].action);l.length&&"|"!=l[l.length-1]&&l.push("|")}for(l.length&&"|"==l[l.length-1]&&l.pop(),m=[],j=0;j<a.mosaic.options.richtext_contextmenu.length;j+=1){for(i=a.mosaic.options.richtext_contextmenu[j],k=0;k<i.actions.length;k+=1)a.inArray(i.actions[k].name,h)>-1&&m.push(i.actions[k].action);m.length&&"|"!=m[m.length-1]&&m.push("|")}m.length&&"|"==m[m.length-1]&&m.pop();var o=function(){0===c.text().replace(/^\s+|\s+$/g,"").length?c.addClass("mosaic-tile-content-empty"):c.removeClass("mosaic-tile-content-empty")};a("body").removeAttr("data-pat-tinymce"),b=c.patternTinymce(a.extend(!0,{},a.mosaic.options.tinymce,{inline:!1,tiny:{body_id:f,selector:"#"+f,inline:!0,fixed_toolbar_container:"#"+f+"-panel",menubar:!1,toolbar:l.join(" ")||!1,statusbar:!1,contextmenu:m.join(" ")||!1,plugins:a.mosaic.options.tinymce.tiny.plugins.concat(m.length?["contextmenu"]:[]),setup:function(b){b.on("focus",function(b){if(b.target.id){var c=a("#"+b.target.id).parents(".mosaic-tile").first();if(c.size()>0){var d=new g(c);d.select()}}}),b.on("change",o),o()}}})),c.addClass("mosaic-rich-text")},g.validTile=function(b){var c=a(b);return c.is(".mosaic-tile")?!0:c.parents(".mosaic-tile").size()>0?!0:!1},g}),define("mosaic-url/mosaic.panel",["jquery","pat-logger","underscore"],function(a,b,c){"use strict";var d=b.getLogger("pat-mosaic"),e=function(b){this.$el=a(b)};return e.prototype.initialize=function(b){var c,d=this.$el.attr("data-panel"),e=a("[data-panel="+d+"]",a.mosaic.document);"content"===d&&0===e.length&&a("#"+d,a.mosaic.document).each(function(){e=a(this),e.attr("data-panel",d)}),"content"===d?(c=e.attr("id"),0===a(".mosaic-original-content",a.mosaic.document).size()?(e.before(a(document.createElement("div")).attr("id",c).attr("class",e.attr("class")).addClass("mosaic-panel").attr("data-panel","content").html(b.find("[data-panel="+d+"]").html())),e.removeAttr("data-panel").removeAttr("id").addClass("mosaic-original-content")):e.replaceWith(a(document.createElement("div")).attr("id",c).attr("class",e.attr("class")).addClass("mosaic-panel").attr("data-panel","content").html(b.find("[data-panel="+d+"]").html()))):(e.attr("class",b.find("[data-panel="+d+"]").attr("class")),e.addClass("mosaic-panel"),e.html(b.find("[data-panel="+d+"]").html()))},e.prototype.prefill=function(){this.$el.hasClass("mosaic-panel")||(d.info(a(this)),a(this).addClass("mosaic-panel"),a(this).children().wrap(a('<div class="mosaic-grid-row"><div class="mosaic-grid-cell mosaic-width-full mosaic-position-leftmost"><div class="movable removable mosaic-tile mosaic-text-tile"><div class="mosaic-tile-content"></div></div></div></div>')))},e}),define("mosaic-url/mosaic.layout",["jquery","mosaic-url/mosaic.tile","pat-logger","underscore","pat-registry"],function(a,b,c,d,e){"use strict";function f(a){switch(a){case 25:return"mosaic-width-quarter";case 33:return"mosaic-width-third";case 50:return"mosaic-width-half";case 66:case 67:return"mosaic-width-two-thirds";case 75:return"mosaic-width-three-quarters";case 100:return"mosaic-width-full"}return"mosaic-width-full"}function g(a){switch(a){case 0:return"mosaic-position-leftmost";case 25:return"mosaic-position-quarter";case 33:return"mosaic-position-third";case 50:return"mosaic-position-half";case 66:case 67:return"mosaic-position-two-thirds";case 75:return"mosaic-position-three-quarters"}return"mosaic-position-leftmost"}return"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.layout={widthClasses:["mosaic-width-quarter","mosaic-width-third","mosaic-width-half","mosaic-width-two-thirds","mosaic-width-three-quarters","mosaic-width-full"],positionClasses:["mosaic-position-leftmost","mosaic-position-quarter","mosaic-position-third","mosaic-position-half","mosaic-position-two-thirds","mosaic-position-three-quarters"]},a.fn.mosaicLayout=function(){var c=function(c){if(27===c.keyCode){var d=a(".mosaic-original-tile",a.mosaic.document);d.length>0?d.each(function(){a(this).addClass("mosaic-drag-cancel"),a(this).hasClass("mosaic-helper-tile-new")?a(document).trigger("mousedown"):a(document).trigger("mouseup")}):a(".mosaic-selected-tile",a.mosaic.document).each(function(){var a=new b(this);a.blur()}),a(".mosaic-resize-handle-helper",a.mosaic.document).each(function(){a(this).parents("[data-panel]").removeClass("mosaic-panel-resizing"),a(this).parent().removeClass("mosaic-row-resizing"),a(this).parent().children(".mosaic-resize-placeholder").remove(),a(this).remove()}),a.mosaic.overlay.app&&a.mosaic.overlay.app.hide()}};a(a.mosaic.document).off("keydown").on("keydown",c);var d=function(b){var c;if(b.target?c=b.target:b.srcElement&&(c=b.srcElement),!(a(c).parents(".mce-panel").length>0)){0===a(c).parents(".mosaic-tile").length&&0===a(c).parents(".mosaic-toolbar").length&&(a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.options.panels.mosaicSetResizeHandleLocation());var d=a(".mosaic-helper-tile-new",a.mosaic.document);d.length>0&&d.each(function(){a(this).mosaicHandleDragEnd()})}};a(a.mosaic.document).off("mousedown").on("mousedown",d);var h=function(b){a(".mosaic-helper-tile-new",a.mosaic.document).each(function(){var c=a(this).parent().offset();a(this).css("top",b.pageY+3-c.top),a(this).css("left",b.pageX+3-c.left)}),a(".mosaic-resize-handle-helper",a.mosaic.document).each(function(){var c,d,e=a(this),h=e.parent(),i=parseFloat(b.pageX-h.offset().left-4),j=i/e.data("row_width")*100,k=25,l=1e3;if(a([25,33,50,67,75]).each(function(){d=Math.abs(this-j),l>d&&(k=this,l=d)}),2===e.data("nr_of_columns"))e.data("column_sizes").split(" ")[0]!==k&&(h.children(".mosaic-resize-placeholder").each(function(b){0===b?a(this).removeClass(a.mosaic.layout.widthClasses.join(" ")).addClass(f(parseInt(k,10))):(a(this).removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(a.mosaic.layout.widthClasses.join(" ")).addClass(f(parseInt(100-k,10))).addClass(g(parseInt(k,10)).replace("position","resize")),e.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(g(parseInt(k,10)).replace("position","resize")))}),a(this).data("column_sizes",k+" "+(100-k)));else{var m=a(this).data("resize_handle_index");if(1===m){if(e.data("column_sizes").split(" ")[a(this).data("resize_handle_index")-1]!==k&&parseInt(k,10)<=50)switch(c=h.children(".mosaic-resize-placeholder"),c.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(a.mosaic.layout.widthClasses.join(" ")),e.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(g(parseInt(k,10)).replace("position","resize")),parseInt(k,10)){case 25:a(c.get(0)).addClass(g(0).replace("position","resize")+" "+f(25)),a(c.get(1)).addClass(g(25).replace("position","resize")+" "+f(50)),a(c.get(2)).addClass(g(75).replace("position","resize")+" "+f(25)),e.data("column_sizes","25 50 25");break;case 33:a(c.get(0)).addClass(g(0).replace("position","resize")+" "+f(33)),a(c.get(1)).addClass(g(33).replace("position","resize")+" "+f(33)),a(c.get(2)).addClass(g(66).replace("position","resize")+" "+f(33)),e.data("column_sizes","33 33 33");break;case 50:a(c.get(0)).addClass(g(0).replace("position","resize")+" "+f(50)),a(c.get(1)).addClass(g(50).replace("position","resize")+" "+f(25)),a(c.get(2)).addClass(g(75).replace("position","resize")+" "+f(25)),e.data("column_sizes","50 25 25")}}else if(e.data("column_sizes").split(" ")[a(this).data("resize_handle_index")]!==100-k&&parseInt(k,10)>=50)switch(c=h.children(".mosaic-resize-placeholder"),c.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).removeClass(a.mosaic.layout.widthClasses.join(" ")),e.removeClass(a.mosaic.layout.positionClasses.join(" ").replace(/position/g,"resize")).addClass(g(parseInt(k,10)).replace("position","resize")),parseInt(k,10)){case 50:a(c.get(0)).addClass(g(0).replace("position","resize")+" "+f(25)),a(c.get(1)).addClass(g(25).replace("position","resize")+" "+f(25)),a(c.get(2)).addClass(g(50).replace("position","resize")+" "+f(50)),e.data("column_sizes","25 25 50");break;case 66:case 67:a(c.get(0)).addClass(g(0).replace("position","resize")+" "+f(33)),a(c.get(1)).addClass(g(33).replace("position","resize")+" "+f(33)),a(c.get(2)).addClass(g(66).replace("position","resize")+" "+f(33)),e.data("column_sizes","33 33 33");break;case 75:a(c.get(0)).addClass(g(0).replace("position","resize")+" "+f(25)),a(c.get(1)).addClass(g(25).replace("position","resize")+" "+f(50)),a(c.get(2)).addClass(g(75).replace("position","resize")+" "+f(25)),e.data("column_sizes","25 50 25")}}})};a(a.mosaic.document).off("mousemove").on("mousemove",h),a(a.mosaic.document).off("dragover").on("dragover",h);var i=function(c){a(".mosaic-resize-handle-helper",a.mosaic.document).each(function(){var c=a(this).parents("[data-panel]"),d=a(this).data("column_sizes").split(" ");a(this).parent().children(".mosaic-grid-cell").each(function(b){for(var c=0,e=0;b>e;e+=1)c+=parseInt(d[e],10);a(this).removeClass(a.mosaic.layout.positionClasses.join(" ")).removeClass(a.mosaic.layout.widthClasses.join(" ")).addClass(g(c)+" "+f(parseInt(d[b],10)))}),c.removeClass("mosaic-panel-resizing"),a(this).parent().removeClass("mosaic-row-resizing"),a(this).parent().children(".mosaic-resize-placeholder").remove(),a(this).parent().mosaicSetResizeHandles(),c.mosaicSetResizeHandleLocation();var e=c.find(".mosaic-selected-tile");if(e.size()>0){var h=new b(e);h.focus()}a(this).remove()})};a(a.mosaic.document).off("mouseup").on("mouseup",i);var j=function(b){if(a(this).parents("[data-panel]").hasClass("mosaic-panel-dragging")&&(a(".mosaic-selected-divider",a.mosaic.document).removeClass("mosaic-selected-divider"),a(this).hasClass("mosaic-original-tile")===!1&&a(this).hasClass("mosaic-tile-align-left")===!1&&a(this).hasClass("mosaic-tile-align-right")===!1)){var c=a(this).mosaicGetDirection(b),d=a(this).children(".mosaic-divider-"+c);if("left"===c||"right"===c){var e=d.parent().parent().parent();e.children(".mosaic-grid-cell").length>1?(d.height(e.height()+5),d.css("top",e.offset().top-d.parent().offset().top-5)):(d.height(d.parent().height()+5),d.css("top",-5))}d.addClass("mosaic-selected-divider")}};a(a.mosaic.document).off("mousemove",".mosaic-tile").on("mousemove",".mosaic-tile",j),a(a.mosaic.document).off("dragover",".mosaic-tile").on("dragover",".mosaic-tile",j),a(a.mosaic.document).off("click",".mosaic-tile").on("click",".mosaic-tile",function(){var a=new b(this);a.select()}),a(a.mosaic.document).off("click",".mosaic-info-icon").on("click",".mosaic-info-icon",function(){var c=new b(a(this).parents(".mosaic-tile")),d=c.getConfig();if("app"===d.tile_type){var f=c.getEditUrl();a(this).parents(".mosaic-tile").addClass("mosaic-edited-tile"),a.mosaic.overlay.app=a(".mosaic-toolbar").patternPloneModal({ajaxUrl:f,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),a.mosaic.overlay.app.$el.off("after-render"),a.mosaic.overlay.app.on("after-render",function(b){a('input[name*="cancel"]',a.mosaic.overlay.app.$modal).off("click").on("click",function(){a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null,a(".mosaic-edited-tile",a.mosaic.document).removeClass("mosaic-edited-tile")}),a.mosaic.hasContentLayout&&a("form",a.mosaic.overlay.app.$modal).append(a('<input type="hidden" name="X-Tile-Persistent" value="yes" />'))}),a.mosaic.overlay.app.show(),a.mosaic.overlay.app.$el.off("formActionSuccess"),a.mosaic.overlay.app.on("formActionSuccess",function(b,d,f,g,h){var i=g.getResponseHeader("X-Tile-Url"),j=a.mosaic.getDomTreeFromHtml(d);if(i){a.mosaic.removeHeadTags(i),a.mosaic.addHeadTags(i,j);var k=j.find(".temp_body_tag").html(),l=a(".mosaic-edited-tile .mosaic-tile-content",a.mosaic.document);l.html(k),c.fillContent(k,i),e.scan(l),a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null}a(".mosaic-edited-tile",a.mosaic.document).removeClass("mosaic-edited-tile")})}else a.mosaic.overlay.open("field",d)});var k=this.length;return this.each(function(c){var d=a(this);if(d.find(".mosaic-tile").each(function(){new b(this).initialize();
}),d.find(".mosaic-tile").mosaicAddDrag(),d.mosaicAddEmptyRows(),d.children(".mosaic-grid-row").mosaicSetResizeHandles(),c===k-1){var e=0,f=0;a.mosaic.options.panels.each(function(b){a(this).width()>e&&(e=a(this).width(),f=b)});var g=a.mosaic.options.panels.eq(f).find(".mosaic-tile:first");if(g.size()>0){var h=new b(g);h.select()}}})},a.fn.mosaicAddMouseMoveEmptyRow=function(){return this.each(function(){a(this).mousemove(function(){var b=a(this).parents("[data-panel]");b.hasClass("mosaic-panel-dragging")&&(a(".mosaic-selected-divider",a.mosaic.document).removeClass("mosaic-selected-divider"),a(this).children("div").addClass("mosaic-selected-divider"))})})},a.fn.mosaicAddEmptyRows=function(){return this.each(function(){a(this).find(".mosaic-grid-row").each(function(b){a(this).children(".mosaic-grid-cell").length>1&&(0===b&&a(this).before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()),(0===a(this).nextAll(".mosaic-grid-row").length||a(this).next().children(".mosaic-grid-cell").length>1)&&a(this).after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow()))}),0===a(this).find(".mosaic-grid-row").length&&a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row mosaic-empty-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-outer-border").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-divider-dot"))))).mosaicAddMouseMoveEmptyRow())})},a.fn.mosaicGetWidthClass=function(){var b;for(b in a.mosaic.layout.widthClasses)if(a.mosaic.layout.widthClasses.hasOwnProperty(b)&&a(this).hasClass(a.mosaic.layout.widthClasses[b]))return a.mosaic.layout.widthClasses[b];for(b in a.mosaic.layout.widthClasses)if(a.mosaic.layout.widthClasses.hasOwnProperty(b)&&a(this).hasClass(a.mosaic.layout.widthClasses[b].replace("position","resize")))return a.mosaic.layout.widthClasses[b];return a.mosaic.layout.widthClasses[0]},a.fn.mosaicGetPositionClass=function(){var b;for(b in a.mosaic.layout.positionClasses)if(a(this).hasClass(a.mosaic.layout.positionClasses[b]))return a.mosaic.layout.positionClasses[b];for(b in a.mosaic.layout.positionClasses)if(a(this).hasClass(a.mosaic.layout.positionClasses[b].replace("position","resize")))return a.mosaic.layout.positionClasses[b];return a.mosaic.layout.positionClasses[0]},a.fn.mosaicAddDrag=function(){return this.each(function(){var b=a(this),c=function(b){var c=a(".mosaic-helper-tile",a.mosaic.document),d=c.parents("[data-panel]").offset();c.css("top",b.pageY+3-d.top),c.css("left",b.pageX+3-d.left)},d=function(){var b=a(".mosaic-helper-tile",a.mosaic.document);a(a.mosaic.document).unbind("mousemove",c).unbind("mouseup",d),b.mosaicHandleDragEnd(),b.remove()};return b.each(function(){b.find("div.mosaic-drag-handle").unbind("mousedown").bind("mousedown",function(b){var e=b.pageX,f=b.pageY,g=function(b){if(Math.max(Math.abs(e-b.pageX),Math.abs(f-b.pageY))>=1){a.mosaic.options.panels.addClass("mosaic-panel-dragging"),a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur();var h=a(b.target).parents(".mosaic-tile"),i=h.clone(!0);h.addClass("mosaic-original-tile"),h.parents("[data-panel]").append(i),i.css({width:h.width(),position:"absolute",opacity:.5}).addClass("mosaic-helper-tile"),a(a.mosaic.document).mousemove(c),a(a.mosaic.document).mouseup(d),a(a.mosaic.document).unbind("mousemove",g)}};a(a.mosaic.document).bind("mousemove",g),a(a.mosaic.document).bind("mouseup",function(){a(a.mosaic.document).unbind("mousemove",g)})})})})},a.fn.mosaicHandleDragEnd=function(){a(this).parents("[data-panel]");a.mosaic.options.panels.removeClass("mosaic-panel-dragging mosaic-panel-dragging-new");var c=a(".mosaic-selected-divider",a.mosaic.document),e=c.parent(),f="";d.each(["top","bottom","left","right"],function(a){c.hasClass("mosaic-divider-"+a)&&(f=a)}),c.removeClass("mosaic-selected-divider");var g=a(".mosaic-helper-tile-new",a.mosaic.document).length>0,h=a(".mosaic-original-tile",a.mosaic.document);if((0===c.length||e.hasClass("mosaic-helper-tile"))&&h.addClass("mosaic-drag-cancel"),h.hasClass("mosaic-drag-cancel"))h.removeClass("mosaic-drag-cancel"),a.mosaic.options.panels.find(".mosaic-empty-row").remove(),g||h.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(e.hasClass("mosaic-empty-row"))e.removeClass("mosaic-empty-row").attr("class",h.parents(".mosaic-grid-row").first().attr("class")).unbind("mousemove"),e.children(".mosaic-grid-cell").children("div").remove(),e.children(".mosaic-grid-cell").append(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile")),a(".mosaic-empty-row",a.mosaic.document).remove();else if(e.hasClass("mosaic-tile")===!1)a(".mosaic-empty-row",a.mosaic.document).remove(),g||h.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");else if(4!==e.parent().parent().children(".mosaic-grid-cell").length||"left"!==f&&"right"!==f){if(a(".mosaic-empty-row",a.mosaic.document).remove(),"top"===f)e.before(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if("bottom"===f)e.after(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"));else if("left"===f||"right"===f)if(1===e.parent().parent().children(".mosaic-grid-cell").length){var i=e.prevAll();i.length>0&&(e.parent().parent().before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(a(i.get().reverse()).clone(!0).mosaicAddDrag()))),i.remove());var j=e.nextAll();j.length>0&&(e.parent().parent().after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-full mosaic-position-leftmost").append(j.clone(!0).mosaicAddDrag()))),j.remove()),e.parent().removeClass(a.mosaic.layout.widthClasses.join(" ")).removeClass(a.mosaic.layout.positionClasses.join(" ")).addClass("mosaic-width-half"),"left"===f?e.parent().addClass("mosaic-position-half").before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):e.parent().addClass("mosaic-position-leftmost").after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-half").append(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),e.parent().parent().mosaicSetResizeHandles()}else"left"===f?e.parent().before(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))):e.parent().after(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell").append(h.clone(!0).removeClass("mosaic-original-tile mosaic-helper-tile mosaic-helper-tile-new mosaic-tile-align-right mosaic-tile-align-left").css({width:"",left:"",top:""}).mosaicAddDrag().addClass("mosaic-new-tile"))),e.parent().parent().mosaicSetColumnSizes(),e.parent().parent().mosaicSetResizeHandles()}else a(".mosaic-empty-row",a.mosaic.document).remove(),g||h.removeClass("mosaic-original-tile").addClass("mosaic-new-tile");var k=h.parent().parent();a(".mosaic-original-tile",a.mosaic.document).remove(),k.mosaicCleanupRow(),a.mosaic.options.panels.mosaicAddEmptyRows();var l=a(".mosaic-new-tile",a.mosaic.document);l.removeClass("mosaic-new-tile");var m=new b(l);a(".mosaic-rich-text",l).size()>0&&m.setupWysiwyg(),g&&m.select()},a.fn.mosaicSetColumnSizes=function(){return this.each(function(){var b=a(this).children(".mosaic-grid-cell").length;a(this).children(".mosaic-grid-cell").each(function(c){switch(a(this).removeClass(a.mosaic.layout.widthClasses.join(" ")).removeClass(a.mosaic.layout.positionClasses.join(" ")),b){case 1:a(this).addClass("mosaic-width-full mosaic-position-leftmost");break;case 2:switch(c){case 0:a(this).addClass("mosaic-width-half mosaic-position-leftmost");break;case 1:a(this).addClass("mosaic-width-half mosaic-position-half")}break;case 3:switch(c){case 0:a(this).addClass("mosaic-width-third mosaic-position-leftmost");break;case 1:a(this).addClass("mosaic-width-third mosaic-position-third");break;case 2:a(this).addClass("mosaic-width-third mosaic-position-two-thirds")}break;case 4:switch(c){case 0:a(this).addClass("mosaic-width-quarter mosaic-position-leftmost");break;case 1:a(this).addClass("mosaic-width-quarter mosaic-position-quarter");break;case 2:a(this).addClass("mosaic-width-quarter mosaic-position-half");break;case 3:a(this).addClass("mosaic-width-quarter mosaic-position-three-quarters")}}})})},a.fn.mosaicSetResizeHandles=function(){return this.each(function(){a(this).children(".mosaic-resize-handle").remove();var b=a(this).children(".mosaic-grid-cell").length;switch(b){case 2:a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+a(a(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize")));break;case 3:a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-one "+a(a(this).children(".mosaic-grid-cell").get(1)).mosaicGetPositionClass().replace("position","resize"))),a(this).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-center mosaic-resize-handle-two "+a(a(this).children(".mosaic-grid-cell").get(2)).mosaicGetPositionClass().replace("position","resize")))}a(this).children(".mosaic-resize-handle").mousedown(function(){var b=[];a(this).parent().children(".mosaic-grid-cell").each(function(){switch(a(this).mosaicGetWidthClass()){case"mosaic-width-half":b.push("50");break;case"mosaic-width-quarter":b.push("25");break;case"mosaic-width-third":b.push("33");break;case"mosaic-width-two-thirds":b.push("66");break;case"mosaic-width-three-quarters":b.push("75")}a(this).parent().append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder "+a(this).mosaicGetWidthClass()+" "+a(this).mosaicGetPositionClass().replace("position","resize")).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-placeholder-inner-border")))});var c=1;return a(this).hasClass("mosaic-resize-handle-two")&&(c=2),a(this).parent().append(a(a.mosaic.document.createElement("div")).addClass("mosaic-resize-handle mosaic-resize-handle-helper").addClass(a(this).mosaicGetPositionClass().replace("position","resize")).data("row_width",a(this).parent().width()).data("nr_of_columns",a(this).parent().children(".mosaic-grid-cell").length).data("column_sizes",b.join(" ")).data("resize_handle_index",c)),a(this).parents("[data-panel]").addClass("mosaic-panel-resizing"),a(this).parent().addClass("mosaic-row-resizing"),a(".mosaic-selected-tile",a.mosaic.document).children(".mosaic-tile-content").blur(),!1})})},a.fn.mosaicCleanupRow=function(){return this.each(function(){var b=a(this);if(b.children(".mosaic-grid-cell").each(function(){0===a(this).children().length&&(a(this).remove(),b.mosaicSetColumnSizes())}),0===b.find(".mosaic-tile").length){var c=b;if(b.nextAll(".mosaic-grid-row").length>0)b=b.next(".mosaic-grid-row");else{if(!(b.prevAll(".mosaic-grid-row").length>0))return void b.remove();b=b.prev(".mosaic-grid-row")}c.remove()}b.prevAll(".mosaic-grid-row").length>0&&1===b.children(".mosaic-grid-cell").length&&1===b.prev().children(".mosaic-grid-cell").length&&(b.children(".mosaic-grid-cell").prepend(b.prev().children(".mosaic-grid-cell").children(".mosaic-tile").clone(!0).mosaicAddDrag()),b.prev().remove()),b.nextAll(".mosaic-grid-row").length>0&&1===b.children(".mosaic-grid-cell").length&&1===b.next().children(".mosaic-grid-cell").length&&(b.children(".mosaic-grid-cell").append(b.next().children(".mosaic-grid-cell").children(".mosaic-tile").clone(!0).mosaicAddDrag()),b.next().remove()),b.mosaicSetResizeHandles()})},a.fn.mosaicSetResizeHandleLocation=function(){var b=a(this);b.children(".mosaic-grid-row").each(function(){var b=a(this),c=b.children(".mosaic-grid-cell");(2===c.length||3===c.length)&&(b.children(".mosaic-resize-handle").removeClass("mosaic-resize-handle-left mosaic-resize-handle-center mosaic-resize-handle-right"),a(c.get(0)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-left"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")):a(c.get(1)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-right"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-left")):3===c.length&&a(c.get(2)).children(".mosaic-tile").hasClass("mosaic-selected-tile")?(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-right")):(b.children(".mosaic-resize-handle-one").addClass("mosaic-resize-handle-center"),b.children(".mosaic-resize-handle-two").addClass("mosaic-resize-handle-center")))})},a.fn.mosaicGetDirection=function(b){var c=parseFloat(a(this).width()),d=parseFloat(a(this).height()),e=parseFloat(b.pageX-a(this).offset().left-c/2),f=parseFloat(b.pageY-a(this).offset().top-d/2),g=c/2,h=d/2;return 0>e?0>f?-1*g/(-1*h)>e/f?"top":"left":-1*g/h>e/f?"left":"bottom":0>f?1*g/(-1*h)>e/f?"right":"top":g/h>e/f?"bottom":"right"},a.mosaic.disableEditHtmlSource=function(){a(".mosaic-rich-text-textarea",a.mosaic.document).each(function(){var c,d;d=a(this).val(),c=a(this).parent(),c.html(d);var e=new b(a(this).parent());e.setupWysiwyg()})},a.mosaic.addAppTile=function(b,c){a.mosaic.overlay.app&&a.mosaic.overlay.app.hide(),a.ajax({type:"GET",url:c,success:function(d){d=a.mosaic.getDomTreeFromHtml(d),a.mosaic.addHeadTags(c,d),a.mosaic.addTile(b,d.find(".temp_body_tag").html(),c)}})},a.mosaic.addAppTileHTML=function(b,c,d){var e;e=a.mosaic.getDomTreeFromHtml(c),a.mosaic.addHeadTags(d,e),a.mosaic.addTile(b,e.find(".temp_body_tag").html(),d)},a.mosaic.editAppTile=function(b){a.mosaic.overlay.close(),window.parent.focus(),a.ajax({type:"GET",url:b,success:function(c){c=a.mosaic.getDomTreeFromHtml(c),a.mosaic.removeHeadTags(b),a.mosaic.addHeadTags(b,c);var d=a(".mosaic-selected-tile .mosaic-tile-content",a.mosaic.document);d.html(c.find(".temp_body_tag").html()),d.attr("data-tileUrl",b.replace(/&/gim,"&amp;"))}})},a.mosaic.addTile=function(c,d,e){a.mosaic.options.panels.addClass("mosaic-panel-dragging mosaic-panel-dragging-new"),a(a.mosaic.options.panels.get(0)).append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-row").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-grid-cell mosaic-width-half mosaic-position-leftmost").append(a(a.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-"+c+"-tile").append(a(a.mosaic.document.createElement("div")).addClass("mosaic-tile-content").attr("data-tileUrl",e&&e.replace(/&/gim,"&amp;")).html(d)).addClass("mosaic-helper-tile mosaic-helper-tile-new mosaic-original-tile"))));var f=a.mosaic.options.panels.find(".mosaic-helper-tile-new"),g=0;a.mosaic.options.panels.each(function(){a(this).width()>g&&(g=a(this).width())}),f.width()<g/4?f.width(g/4):f.width(f.width()),new b(f).initialize()},a.mosaic.getDefaultValue=function(b){var c,d,e,f;switch("IDublinCore-title"===b.name?(e='<h1 class="documentFirstHeading">',f="</h1>"):"IDublinCore-description"===b.name?(e='<p class="documentDescription">',f="</p>"):(e="<div>",f="</div>"),b.tile_type){case"field":switch(b.widget){case"z3c.form.browser.text.TextWidget":case"z3c.form.browser.text.TextFieldWidget":return e+a("#"+b.id,a.mosaic.document).find("input").attr("value")+f;case"z3c.form.browser.textarea.TextAreaWidget":case"z3c.form.browser.textarea.TextAreaFieldWidget":case"z3c.form.browser.textlines.TextLinesWidget":case"z3c.form.browser.textlines.TextLinesFieldWidget":for(var g=a("#"+b.id,a.mosaic.document).find("textarea").val().split("\n"),h="",i=0;i<g.length;i+=1)h+=g[i]+"<br/>";return e+h+f;case"plone.app.z3cform.widget.RichTextFieldWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygWidget":case"plone.app.z3cform.wysiwyg.widget.WysiwygFieldWidget":case"plone.app.widgets.dx.RichTextWidget":return c=a("#"+b.id).find("textarea").attr("id"),d=tinymce.get(c),d?d.getContent():"";default:return'<div class="discreet">Placeholder for field:<br/><b>'+b.label+"</b></div>"}break;default:return b.default_value}},a.mosaic.getPageContent=function(){var c,d=1,e=12,f="",g="",h="";return a.mosaic.disableEditHtmlSource(),f+="  <body>\n",a("[data-panel]",a.mosaic.document).each(function(){h=a(this).attr("data-panel"),f+='    <div data-panel="'+h+'">\n',a(this).children(".mosaic-grid-row").each(function(){a(this).hasClass("mosaic-empty-row")===!1&&(g=a(this).attr("class"),f+='      <div class="'+g+'"\n',f+='           data-grid=\'{"type": "row"}\'>\n',a(this).children(".mosaic-grid-cell").each(function(){switch(a(this).mosaicGetPositionClass()){case"mosaic-position-leftmost":d=1;break;case"mosaic-position-quarter":d=4;break;case"mosaic-position-third":d=5;break;case"mosaic-position-half":d=7;break;case"mosaic-position-two-thirds":d=9;break;case"mosaic-position-three-quarters":d=10}switch(a(this).mosaicGetWidthClass()){case"mosaic-width-half":e=6;break;case"mosaic-width-quarter":e=3;break;case"mosaic-width-third":e=4;break;case"mosaic-width-two-thirds":e=8;break;case"mosaic-width-three-quarters":e=9;break;case"mosaic-width-full":e=12}f+='        <div class="'+a(this).attr("class")+'"\n',f+='             data-grid=\'{"type": "cell", "info":{"xs": "true", "sm": "true", "lg": "true", "pos": {"x": '+d+', "width": '+e+"}}}'>\n",a(this).children(".mosaic-tile").each(function(){var a=new b(this);f+=a.getHtmlBody()}),f+="        </div>\n"}),f+="      </div>\n")}),f+="    </div>\n"}),f+="  </body>\n",c='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" data-layout="'+a.mosaic.options.layout+'">\n',c+=f,c+="</html>\n"},a.mosaic.saveTileFormData=function(){a("[data-panel]",a.mosaic.document).each(function(){a(this).find(".mosaic-tile").each(function(){var a=new b(this);a.saveForm()})})},a.mosaic.saveLayoutToForm=function(){a.mosaic.saveTileFormData();var b=a("#form-widgets-ILayoutAware-content, [name='form.widgets.ILayoutAware.content']");a.mosaic.hasContentLayout?b.val(""):b.val(a.mosaic.getPageContent())},{Tile:b}}),define("mosaic-url/mosaic.toolbar",["jquery","mosaic-url/mosaic.tile","mosaic-url/mosaic.layout"],function(a,b){"use strict";function c(b,c){var e;void 0!==typeof c.menu&&c.menu?c.icon?(e=a(document.createElement("label")),b.append(e.addClass("mosaic-icon-menu mosaic-icon-menu-"+d(c.name)+" mosaic-icon").html(c.label).attr("title",c.label).append(a(document.createElement("select")).addClass("mosaic-menu-"+d(c.name)).data("action",c.action).change(function(){a(this).mosaicExecAction()}).each(function(){var b,e,f;for(b in c.items)if(void 0!==c.items[b].items){a(this).append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(c.items[b].value)).attr("label",c.items[b].label)),e=a(this).find(".mosaic-option-group-"+d(c.items[b].value));for(f in c.items[b].items)e.append(a(document.createElement("option")).attr("value",c.items[b].items[f].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].items[f].value)).html(c.items[b].items[f].label))}else a(this).append(a(document.createElement("option")).attr("value",c.items[b].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].value)).html(c.items[b].label))})))):(e=a(document.createElement("select")),b.append(e.addClass("mosaic-menu mosaic-menu-"+c.name.replace(/_/g,"-")).data("action",c.action).change(function(){a(this).mosaicExecAction()}).each(function(){var b,e,f;for(b=0;b<c.items.length;b+=1)if(void 0!==c.items[b].items){a(this).append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(c.items[b].value)).attr("label",c.items[b].label)),e=a(this).find(".mosaic-option-group-"+d(c.items[b].value));for(f in c.items[b].items)e.append(a(document.createElement("option")).attr("value",c.items[b].items[f].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].items[f].value)).html(c.items[b].items[f].label))}else a(this).append(a(document.createElement("option")).attr("value",c.items[b].value).addClass("mosaic-option mosaic-option-"+d(c.items[b].value)).html(c.items[b].label))}))):(e=a(document.createElement("button")),b.append(e.addClass("mosaic-button mosaic-button-"+d(c.name)+(c.icon?" mosaic-icon":"")).html(c.label).attr("title",c.label).attr("type","button").data("action",c.action).mousedown(function(){a(this).mosaicExecAction()}))),a.mosaic.actionManager.actions[c.name]&&(a.mosaic.actionManager.actions[c.name].visible()||e.hide())}"undefined"==typeof a.mosaic&&(a.mosaic={});var d=function(a){return a.replace(/(_|\.|\/)/g,"-")};a.fn._mosaicToolbarLayoutEditor=function(b){a(".mosaic-toolbar-secondary-functions",this).show();var e,f,g,h;if(void 0!==a.mosaic.options.formats)for(e=0;e<a.mosaic.options.formats.length;e+=1){for(g=a.mosaic.options.formats[e],b.primary_actions.append(a(document.createElement("fieldset")).addClass("mosaic-button-group mosaic-button-group-"+d(g.name))),h=b.primary_actions.children(".mosaic-button-group-"+g.name.replace(/_/g,"-")),f=0;f<g.actions.length;f+=1)g.actions[f].favorite&&c(h,g.actions[f]);0===h.children().length&&h.remove()}if(void 0!==a.mosaic.options.tiles){var i=b.secondary_actions.find(".mosaic-menu-insert");for(e=0;e<a.mosaic.options.tiles.length;e+=1){for(g=a.mosaic.options.tiles[e],i.append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(g.name)).attr("label",g.label)),h=b.secondary_actions.find(".mosaic-option-group-"+d(g.name)),f=0;f<g.tiles.length;f+=1){var j=g.tiles[f];h.append(a(document.createElement("option")).addClass("mosaic-option mosaic-option-"+d(j.name)).attr("value",j.name).html(j.label))}0===h.children().length&&h.remove()}}if(void 0!==a.mosaic.options.formats){var k=b.secondary_actions.find(".mosaic-menu-format");for(e=0;e<a.mosaic.options.formats.length;e+=1){for(g=a.mosaic.options.formats[e],k.append(a(document.createElement("optgroup")).addClass("mosaic-option-group mosaic-option-group-"+d(g.name)).attr("label",g.label)),h=b.secondary_actions.find(".mosaic-option-group-"+d(g.name)),f=0;f<g.actions.length;f+=1){var l=g.actions[f];l.favorite===!1&&h.append(a(document.createElement("option")).addClass("mosaic-option mosaic-option-"+d(l.name)).attr("value",l.name).html(l.label).data("action",l.action))}0===h.children().length&&h.remove()}}},a.fn.mosaicToolbar=function(){return this.each(function(){var e,f,g,h,i,j,k,l,m,n;e=a(this),e.html(""),e.append(a(document.createElement("div")).addClass("mosaic-inline-toolbar")),e=e.children(".mosaic-inline-toolbar"),e.append(a(document.createElement("div")).addClass("mosaic-toolbar-content")),f=e.children(".mosaic-toolbar-content"),g={},f.append(a(document.createElement("div")).addClass("mosaic-toolbar-primary-functions")),g.primary_actions=f.children(".mosaic-toolbar-primary-functions"),f.append(a(document.createElement("div")).addClass("mosaic-toolbar-secondary-functions")),g.secondary_actions=f.children(".mosaic-toolbar-secondary-functions");for(h in g)for(i=0;i<a.mosaic.options[h].length;i+=1)if(void 0===a.mosaic.options[h][i].actions)c(g[h],a.mosaic.options[h][i]);else for(j=a.mosaic.options[h][i],g[h].append(a(document.createElement("fieldset")).addClass("mosaic-button-group mosaic-button-group-"+d(a.mosaic.options[h][i].name))),k=g[h].children(".mosaic-button-group-"+d(a.mosaic.options[h][i].name)),l=0;l<j.actions.length;l+=1)c(k,j.actions[l]);e._mosaicToolbarLayoutEditor(g),a.mosaic.hasContentLayout&&a(".mosaic-toolbar-secondary-functions",this).hide(),m=function(){var b;parseInt(a(window).scrollTop(),10)>parseInt(e.parent().offset().top,10)?e.hasClass("mosaic-inline-toolbar")&&(b=e.offset().left,e.width(e.width()).css({left:b,"margin-left":"0px"}).removeClass("mosaic-inline-toolbar").addClass("mosaic-external-toolbar").parent().height(e.height())):e.hasClass("mosaic-external-toolbar")&&e.css({width:"",left:"","margin-left":""}).removeClass("mosaic-external-toolbar").addClass("mosaic-inline-toolbar").parent().css("height","")},a(window).bind("scroll",m),n=function(){var c,d,e,f,g,h;a.mosaic.disableEditHtmlSource(),c=a(this);var i=a(".mosaic-selected-tile",a.mosaic.document);if(i.length>0){var j=new b(i);d=j.getType()}for(e=a.mosaic.options.default_available_actions,f=0;f<a.mosaic.options.tiles.length;f+=1)for(g=a.mosaic.options.tiles[f],h=0;h<g.tiles.length;h+=1)g.tiles[h].name===d&&(e=e.concat(g.tiles[h].available_actions));i.hasClass("removable")||(e=a(e).filter(function(){return"remove"!==this})),c.find(".mosaic-option-group").show(),c.find(".mosaic-button").hide(),c.find(".mosaic-menu").hide(),c.find(".mosaic-icon-menu").hide(),c.find(".mosaic-menu-format").find(".mosaic-option").hide().attr("disabled","disabled"),a(c.find(".mosaic-menu-format").find(".mosaic-option").get(0)).show().removeAttr("disabled"),a(e).each(function(b,d){(!a.mosaic.actionManager.actions[d]||a.mosaic.actionManager.actions[d].visible())&&(c.find(".mosaic-button-"+d).show(),c.find(".mosaic-icon-menu-"+d).show(),c.find(".mosaic-menu-"+d).show(),c.find(".mosaic-option-"+d).show().removeAttr("disabled"))}),c.find(".mosaic-menu-insert").children(".mosaic-option-group-fields").children().each(function(){0===a.mosaic.options.panels.find(".mosaic-"+a(this).attr("value")+"-tile").length?a(this).show().removeAttr("disabled"):a(this).hide().attr("disabled","disabled")}),c.find(".mosaic-option-group").each(function(){0===a(this).children(":enabled").length&&a(this).hide()}),a(".mosaic-menu, .mosaic-icon-menu",a.mosaic.document).each(function(){1===a(this).find(".mosaic-option:enabled").length&&a(this).hide()})},a(".mosaic-button-remove").hover(function(){a(".mosaic-selected-tile .mosaic-tile-content").addClass("mosaic-remove-target")},function(){a(".mosaic-selected-tile .mosaic-tile-content").removeClass("mosaic-remove-target")}),a(this).bind("selectedtilechange",n),a(this).trigger("selectedtilechange"),a(".mosaic-menu").each(function(){a(this).select2({width:"style",dropdownCssClass:"mosaic-dropdown mosaic-dropdown-"+a(this).data("action"),dropdownAutoWidth:!0,minimumResultsForSearch:99})});var o=(new Date).getTime();a(this).on("selectedtilechange",function(){a.mosaic.overlay.app||(new Date).getTime()-o>2e3&&(a.mosaic.saveLayoutToForm(),a("#form-widgets-ILayoutAware-content, [name='form.widgets.ILayoutAware.content']").blur(),o=(new Date).getTime())})})}}),define("mosaic-url/mosaic.actions",["jquery","mosaic-url/mosaic.tile","mockup-utils"],function(a,b,c){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.actionManager={actions:[],shortcuts:[]},a.mosaic.registerAction=function(b,c){c=a.extend({exec:function(){},shortcut:{ctrl:!1,alt:!1,shift:!1,key:""},visible:function(a){return!0},undoable:!1},c),a.mosaic.actionManager.actions[b]=c,""!==c.shortcut.key&&(c.shortcut.charCode=c.shortcut.key.toUpperCase().charCodeAt(0),c.shortcut.action=b,a.mosaic.actionManager.shortcuts.push(c.shortcut))},a.fn.mosaicExecAction=function(){return this.each(function(){if(""!==a(this).data("action")){var b=a.mosaic.actionManager;b.actions[a(this).data("action")].exec(this),b.actions[a(this).data("action")].undoable&&a.mosaic.undo.snapshot()}})},a.mosaic.fixWebkitSpan=function(){var b=a(".Apple-style-span",a.mosaic.document);b.after(b.html()),b.remove()},a.mosaic.getPrefixedClassName=function(a){return a.indexOf("-")>-1?"mosaic-"+a:"mosaic"+a.charAt(0).toUpperCase()+a.slice(1)},a.mosaic.initActions=function(){a.mosaic.registerAction("tile-toggle-class",{exec:function(){var b;arguments.length>0&&arguments[0].value&&(b=a.mosaic.getPrefixedClassName(arguments[0].value),a(".mosaic-selected-tile",a.mosaic.document).toggleClass(b))}}),a.mosaic.registerAction("tile-remove-format",{exec:function(){var b,c,d,e,f;for(b=0;b<a.mosaic.options.formats.length;b++)for(d=a.mosaic.options.formats[b],c=0;c<d.actions.length;c++)e=d.actions[c],"tile"===e.category&&(f=a.mosaic.getPrefixedClassName(e.name),a(".mosaic-selected-tile",a.mosaic.document).removeClass(f))}}),a.mosaic.registerAction("row-toggle-class",{exec:function(){var b;arguments.length>0&&arguments[0].value&&(b=a.mosaic.getPrefixedClassName(arguments[0].value),a(".mosaic-selected-tile",a.mosaic.document).parents(".mosaic-grid-row").first().toggleClass(b))}}),a.mosaic.registerAction("row-remove-format",{exec:function(){var b,c,d,e,f;for(b=0;b<a.mosaic.options.formats.length;b++)for(d=a.mosaic.options.formats[b],c=0;c<d.actions.length;c++)e=d.actions[c],"row"===e.category&&(f=a.mosaic.getPrefixedClassName(e.name),a(".mosaic-selected-tile",a.mosaic.document).parents(".mosaic-grid-row").first().removeClass(f))}}),a.mosaic.registerAction("tile-align-block",{exec:function(){a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-tile-align-right").removeClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"b"}}),a.mosaic.registerAction("tile-align-left",{exec:function(){a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-tile-align-right").addClass("mosaic-tile-align-left")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"l"}}),a.mosaic.registerAction("tile-align-right",{exec:function(){a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-tile-align-left").addClass("mosaic-tile-align-right")},shortcut:{ctrl:!0,alt:!1,shift:!0,key:"r"}}),a.mosaic.registerAction("save",{exec:function(){a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.saveLayoutToForm(),a("#form-buttons-save").click()},shortcut:{ctrl:!0,alt:!1,shift:!1,key:"s"}}),a.mosaic.registerAction("cancel",{exec:function(){a("#form-buttons-cancel").click()}}),a.mosaic.registerAction("html",{
exec:function(){var b,c,d;b=a(".mosaic-selected-tile",a.mosaic.document).children(".mosaic-tile-content"),0===b.find(".mosaic-rich-text-textarea").length&&(c=b.html(),d=b.height(),b.empty(),b.prepend(a(a.mosaic.document.createElement("textarea")).addClass("mosaic-rich-text-textarea").html(a.trim(c)).height(d)))}}),a.mosaic.registerAction("undo",{exec:function(){a.mosaic.undo.undo()}}),a.mosaic.registerAction("redo",{exec:function(){a.mosaic.undo.redo()}}),a.mosaic.registerAction("properties",{exec:function(){a.mosaic.overlay.open("all")}}),a.mosaic.registerAction("customizelayout",{exec:function(){a.mosaic.setSelectedContentLayout(""),a(".mosaic-toolbar-secondary-functions").show(),a(".mosaic-button-customizelayout").hide(),a(".mosaic-panel .mosaic-tile",a.mosaic.document).each(function(){var a=new b(this);a.makeMovable(),a.$el.mosaicAddDrag()})},visible:function(){return a.mosaic.hasContentLayout&&a.mosaic.options.canChangeLayout}}),a.mosaic.registerAction("changelayout",{exec:function(){var b=a.mosaic.hasContentLayout;b||(b=confirm("Changing your will destroy all existing custom layout settings you have in place. Are you sure you want to continue?")),b&&a.mosaic.selectLayout()},visible:function(){return a.mosaic.options.available_layouts.length>0}}),a.mosaic.registerAction("add-tile",{exec:function(){var b=a(".mosaic-toolbar").patternPloneModal({ajaxUrl:a.mosaic.options.context_url+"/@@add-tile?form.button.Create=Create"});b.show()}}),a.mosaic.registerAction("format",{exec:function(b){a(b).find("[value="+a(b).val()+"]").mosaicExecAction(),a(b).select2("val","none")}}),a.mosaic.registerAction("remove",{exec:function(c){a(".mosaic-selected-tile",a.mosaic.document).each(function(){var c=new b(this),d=c.getConfig();if("app"===d.tile_type){var e=c.getUrl();a.mosaic.removeHeadTags(e);var f=e.split("?")[0];f=f.split("@@");var g=f[1].split("/");f=f[0]+"@@delete-tile/"+g[0]+"/"+g[1],f.match(/^\.\/.*/)&&(f=a.mosaic.options.context_url+f.replace(/^\./,"")),a.ajax({type:"GET",url:f,success:function(b){var c=a(b).find('[name="_authenticator"]').val();a.ajax({type:"POST",url:f,data:{"buttons.delete":"Delete",_authenticator:c},success:function(a){}})}})}a.mosaic.options.panels.find(".mosaic-empty-row").remove();var h=a(this).parent().parent();c.saveForm(),a(this).remove(),a.mosaic.undo.snapshot(),h.mosaicCleanupRow(),a.mosaic.options.panels.mosaicAddEmptyRows(),a.mosaic.options.toolbar.trigger("selectedtilechange"),a.mosaic.options.toolbar.mosaicSetResizeHandleLocation()})},visible:function(){return!a.mosaic.hasContentLayout}}),a.mosaic.registerAction("insert",{exec:function(b){var d,e,f,g,h;if("none"===a(b).val())return!1;for(f=a(b).val(),a(".mosaic-selected-tile",a.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),a.mosaic.options.panels.trigger("selectedtilechange"),g=0;g<a.mosaic.options.tiles.length;g+=1)for(e=a.mosaic.options.tiles[g],h=0;h<e.tiles.length;h+=1)e.tiles[h].name===f&&(d=e.tiles[h]);if("app"===d.tile_type){var i=!0;c.loading.show(),a.ajax({type:"GET",url:a.mosaic.options.context_url+"/@@add-tile?tiletype="+f+"&form.button.Create=Create",success:function(b,d){c.loading.hide();var e,g,h,j;e=a(b),g=e.find("#add_tile").attr("action"),h=e.find('[name="_authenticator"]').val(),j=function(b){a.mosaic.overlay.app=a(".mosaic-toolbar").patternPloneModal({html:b,loadLinksWithinModal:!0,buttons:'.formControls > input[type="submit"], .actionButtons > input[type="submit"]'}),a.mosaic.overlay.app.$el.off("after-render"),a.mosaic.overlay.app.on("after-render",function(b){i&&(a(".field.error",a.mosaic.overlay.app.$modal).removeClass("error"),a(".fieldErrorBox,.portalMessage",a.mosaic.overlay.app.$modal).remove(),i=!1),a('input[name*="cancel"]',a.mosaic.overlay.app.$modal).off("click").on("click",function(){a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null})}),a.mosaic.overlay.app.show(),a.mosaic.overlay.app.$el.off("formActionSuccess"),a.mosaic.overlay.app.on("formActionSuccess",function(b,c,d,e){var g=e.getResponseHeader("X-Tile-Url");g&&(a.mosaic.addAppTileHTML(f,c,g),a.mosaic.overlay.app.hide(),a.mosaic.overlay.app=null)})},a("form .required",e).filter(function(){var b=a(this).parents(".field").first().find("input, select, textarea").not('[type="hidden"]').last().val();return null===b||0==b.length}).length>0?j(b):g&&a("form",e).ajaxSubmit({type:"POST",url:g,data:{"buttons.save":"Save",_authenticator:h},success:function(b,c,d){var e=d.getResponseHeader("X-Tile-Url");e?a.mosaic.addAppTileHTML(f,b,e):j(b)}})}})}else a.mosaic.addTile(f,a.mosaic.getDefaultValue(d));return a(b).select2("val","none"),!0}}),a(document).keypress(function(b){var c="";return a(a.mosaic.actionManager.shortcuts).each(function(){b.ctrlKey!==this.ctrl&&(-1===navigator.userAgent.toLowerCase().indexOf("macintosh")||b.metaKey!==this.ctrl)||b.altKey!==this.alt&&void 0!==b.altKey||b.shiftKey!==this.shift||!b.charCode||String.fromCharCode(b.charCode).toUpperCase().charCodeAt(0)!==this.charCode||(c=this.action)}),""!==c?(a.mosaic.actionManager.actions[c].exec(),a.mosaic.actionManager.actions[c].undoable&&a.mosaic.undo.snapshot(),!1):!0})}}),define("mosaic-url/mosaic.core",["jquery","pat-logger","underscore","mosaic-url/mosaic.tile","mosaic-url/mosaic.panel","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.layout","mosaic-url/mosaic.actions"],function(a,b,c,d,e){"use strict";b.getLogger("pat-mosaic");"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.loaded=!1,a.mosaic.selectLayoutTemplate=c.template('<div><h1>Select Layout</h1><div class="mosaic-select-layout"><ul><% _.each(available_layouts, function(layout){ var screenshot = layout.screenshot;if(!screenshot){screenshot = "++resource++plone.app.mosaic.images/default-layout-screenshot.png";} %><li><a href="#" data-value="<%- layout.path %>"><p><%- layout.title %></p><img src="<%- screenshot %>"></a></li><% }); %></ul></div><div class="buttons"><!-- <button class="plone-btn plone-btn-default">Select</button> --></div></div>'),a.mosaic.initialized=function(){a.mosaic.loaded||(a.mosaic.loaded=!0,a.mosaic.undo.snapshot())},a.mosaic.init=function(b){b=a.extend({url:window.document.location.href,type:"",ignore_context:!1},b),a.mosaic.document=window.document;var c;a.mosaic.initActions(),c=b.url.match(/^([\w#!:.?+=&%@!\-\/]+)\/edit$/),c&&(b.url=c[1]),c=b.url.match(/^([\w#:.?=%@!\-\/]+)\/\+\+add\+\+([\w#!:.?+=&%@!\-\/]+)$/),c&&(b.url=c[1],b.type=c[2],b.ignore_context=!0),a.mosaic.options=b.data,a.mosaic.options.url=b.url,a.mosaic.options.ignore_context=b.ignore_context,a.mosaic.options.tileheadelements=[],a.mosaic.hasContentLayout=!0;var d=a.mosaic.getSelectedContentLayout();if(d)a.mosaic.applyLayout(d);else{var e=a(a.mosaic.options.customContentLayout_field_selector).val();if(e){var f=a.mosaic.getDomTreeFromHtml(e);"no-layout"===f.attr("id")?a.mosaic.selectLayout(!0):(a.mosaic.hasContentLayout=!1,a.mosaic._init(f))}else a.mosaic.selectLayout(!0)}},a.mosaic.getSelectedContentLayout=function(){return a(a.mosaic.options.contentLayout_field_selector).val()},a.mosaic.setSelectedContentLayout=function(b){return b?(a.mosaic.hasContentLayout=!0,a(".mosaic-toolbar-secondary-functions",a.mosaic.document).hide()):a.mosaic.hasContentLayout=!1,a(a.mosaic.options.contentLayout_field_selector).attr("value",b)},a.mosaic._initPanels=function(b){a.mosaic.options.layout=b.attr("data-layout"),a("[data-panel] [data-panel]",a.mosaic.document).removeAttr("data-panel"),b.find("[data-panel]").each(function(){var a=new e(this);a.initialize(b)}),a("[data-panel]",a.mosaic.document).each(function(){var a=new e(this);a.prefill()}),a.mosaic.options.panels=a(".mosaic-panel",a.mosaic.document),a.mosaic.options.panels.find("[data-tile]").each(function(){if(d.validTile(this)){var b=new d(a(this).parent());b.initializeContent()}})},a.mosaic._init=function(b){a.mosaic._initPanels(b),a(".mosaic-original-content",a.mosaic.document).mosaicOverlay(),a("body").prepend(a(document.createElement("div")).addClass("mosaic-toolbar")),a.mosaic.options.toolbar=a(".mosaic-toolbar"),a.mosaic.options.toolbar.mosaicToolbar(),a.mosaic.options.panels.mosaicLayout(),a("*",a.mosaic.document).each(function(){var b;b=a(this),"block"===b.css("display")&&(b.hasClass("mosaic-panel")||b.hasClass("mosaic-toolbar")||b.hasClass("mosaic-notifications")||b.hasClass("mosaic-modal-wrapper")||"edit-zone"===b.attr("id")||0===b.parents(".mosaic-panel, .mosaic-toolbar").length&&0===b.find(".mosaic-panel, .mosaic-toolbar").length&&0!==b.parent().find(".mosaic-panel, .mosaic-toolbar").length&&b.addClass("mosaic-blur"))}),a.mosaic.undo.init(),a("body").addClass("mosaic-enabled"),a.mosaic.initialized()},a.mosaic.applyLayout=function(b,c){void 0===c&&(c=function(){}),a.ajax({url:a.mosaic.options.context_url+"/"+b}).done(function(c){var d=a.mosaic.getDomTreeFromHtml(c);a.mosaic.setSelectedContentLayout(b),a.mosaic.loaded?(a.mosaic._initPanels(d),a.mosaic.options.panels.mosaicLayout()):a.mosaic._init(d)})},a.mosaic.selectLayout=function(b){if(void 0!==b&&b&&1===a.mosaic.options.available_layouts.length){var d=a.mosaic.options.available_layouts[0],e="++contentlayout++"+d.directory+"/"+d.file;return void a.mosaic.applyLayout(e)}if(0===a.mosaic.options.available_layouts.length)return void a.mosaic.applyLayout("++contentlayout++default/basic.html");var f=a("<div/>").appendTo("body"),g=f.patternPloneModal({html:a.mosaic.selectLayoutTemplate(a.mosaic.options),content:null,buttons:".plone-btn"});g.on("shown",function(){a("li a",g.$modal).off("click").on("click",function(b){b.preventDefault();var d,e=a(this).attr("data-value");c.each(a.mosaic.options.available_layouts,function(a){a.path===e&&(d=a)});var f="++contentlayout++"+d.directory+"/"+d.file;g.hide(),a.mosaic.applyLayout(f)})}),g.show()},a.mosaic.getDomTreeFromHtml=function(b){return b=b.replace(/<!DOCTYPE[\w\s\- .\/\":]+>/,""),b=b.replace(/<html>/,'<div class="temp_html_tag">'),b=b.replace(/<\/html>/,"</div>"),b=b.replace(/<html\s/,'<div class="temp_html_tag" '),b=b.replace(/<\/html\s/,"</div "),b=b.replace(/<head>/,'<div class="temp_head_tag">'),b=b.replace(/<\/head>/,"</div>"),b=b.replace(/<head\s/,'<div class="temp_head_tag" '),b=b.replace(/<\/head\s/,"</div "),b=b.replace(/<body>/,'<div class="temp_body_tag">'),b=b.replace(/<\/body>/,"</div>"),b=b.replace(/<body\s/,'<div class="temp_body_tag" '),b=b.replace(/<\/body\s/,"</div "),a(a(b)[0])},a.mosaic.removeHeadTags=function(b){var c,d,e,f;if(b=b.split("?")[0],b=b.split("@@"),c=b[1].split("/"),b=b[0]+"@@delete-tile?type="+c[0]+"&id="+c[1]+"&confirm=true",d=c[0].replace(/\./g,"-")+"-"+c[1],e=a.mosaic.options.tileheadelements[d])for(f=0;f<e.length;f+=1)a(e[f],a.mosaic.document).remove();a.mosaic.options.tileheadelements[d]=[]},a.mosaic.addHeadTags=function(b,c){var d,e;b=b.split("?")[0],b=b.split("@@"),d=b[1].split("/"),e=d[0].replace(/\./g,"-")+"-"+d[1],a.mosaic.options.tileheadelements[e]=[],c.find(".temp_head_tag").children().each(function(){a.mosaic.options.tileheadelements[e].push(this),a("head",a.mosaic.document).append(this)})}}),define("mosaic-url/mosaic.upload",["jquery"],function($){"use strict";"undefined"==typeof $.mosaic&&($.mosaic={}),$.mosaic.initUpload=function(){$(".mosaic-panel",$.mosaic.document).bind("dragover",function(a){0===$(".mosaic-panel-dragging",$.mosaic.document).length&&($(".mosaic-selected-tile",$.mosaic.document).removeClass("mosaic-selected-tile").children(".mosaic-tile-content").blur(),$.mosaic.options.toolbar.trigger("selectedtilechange"),$.mosaic.options.panels.mosaicSetResizeHandleLocation(),$.mosaic.addTile("image",'<img src="++resource++plone.app.mosaic.images/files.png" border="0" />'))}),document.addEventListener("drop",function(event){var dt,first,i,files,newtile,file,img,tile,xhr,boundary,data;for(dt=event.dataTransfer,files=dt.files,event.stopPropagation(),event.preventDefault(),$($.mosaic.document).trigger("mousedown"),first=!0,i=0;i<files.length;i+=1)file=files.item(i),0===file.mediaType.indexOf("image")?(first?(img=$(".mosaic-selected-tile",$.mosaic.document).children(".mosaic-tile-content").children("img"),tile=$(".mosaic-selected-tile",$.mosaic.document),first=!1):(newtile=$($.mosaic.document.createElement("div")).addClass("movable removable mosaic-tile mosaic-image-tile").append($($.mosaic.document.createElement("div")).addClass("mosaic-tile-content").append($($.mosaic.document.createElement("img")).attr("border",0))),$(".mosaic-selected-tile",$.mosaic.document).after(newtile),newtile.mosaicInitTile(),newtile.mosaicAddDrag(),img=newtile.children(".mosaic-tile-content").children("img"),tile=newtile),tile.append($($.mosaic.document.createElement("div")).addClass("mosaic-tile-uploadprogress")),img.get(0).src=file.getAsDataURL(),xhr=new XMLHttpRequest,xhr.upload.log=img,xhr.addEventListener("load",function(event){var response=eval("("+event.target.responseText+")");1===response.status?$.plone.notify({type:"error",title:"Error",message:response.message,sticky:!0}):$(event.target.upload.log).attr({src:response.url,alt:response.title}).parents(".mosaic-tile").children(".mosaic-tile-uploadprogress").fadeOut("slow",function(){$(this).remove()})},!1),xhr.upload.addEventListener("error",function(a){$.plone.notify({type:"error",title:"Error",message:"Error uploading file: "+a,sticky:!0})},!1),boundary="AJAX---------------------------AJAX",xhr.open("POST",$.mosaic.options.url+"/@@mosaic-upload",!0),xhr.setRequestHeader("Content-Type","multipart/form-data; boundary="+boundary),data="--"+boundary+"\r\n",data+="Content-Disposition: form-data; ",data+='name="uploadfile"; ',data+='filename="'+file.fileName+'"\r\n',data+="Content-Type: "+file.mediaType,data+="\r\n\r\n",data+=file.getAsBinary()+"\r\n",data+="--"+boundary+"--\r\n",xhr.sendAsBinary(data)):$.plone.notify({type:"warning",title:"Warning",message:"The filetype of file "+file.fileName+" is unsupported",sticky:!0});first&&$(".mosaic-button.remove").mosaicExecAction()},!1)}}),define("mosaic-url/mosaic.editor",["jquery"],function(a){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.editor={},a.mosaic.execCommand=function(a,b,c){tinymce.activeEditor&&tinymce.activeEditor.execCommand(a,b,c)},a.mosaic.editor.applyFormat=function(a){tinymce.activeEditor&&tinyMCE.activeEditor.formatter.apply(a)},a.mosaic.editor.registerFormat=function(a,b){tinymce.activeEditor&&tinymce.activeEditor.formatter.register(a,b)}}),define("mosaic-url/mosaic.undo",["jquery"],function(a){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.undo=function(){},a.mosaic.undo.init=function(){function b(b){for(var c=0;c<b.length;c+=1)a("#"+b[c].target,a.mosaic.document).html(b[c].source)}a.mosaic.undo.undoManager=new a.mosaic.undo.UndoManager(10,b)},a.mosaic.undo.snapshot=function(){var b=[];a(".mosaic-panel",a.mosaic.document).each(function(){b.push({target:a(this).attr("id"),source:a(this).html()})}),"undefined"==typeof a.mosaic.undo.undoManager&&a.mosaic.undo.init(),a.mosaic.undo.undoManager.add(b)},a.mosaic.undo.hasInitial=function(){return a.mosaic.undo.undoManager.stack.size()>0?!0:!1},a.mosaic.undo.undo=function(){a.mosaic.undo.undoManager.undo()},a.mosaic.undo.redo=function(){a.mosaic.undo.undoManager.redo()},a.mosaic.undo.Stack=function(a){"undefined"==typeof a?this.maxsize=10:this.maxsize=a,this.stack=[]},a.mosaic.undo.Stack.prototype.size=function(){return this.stack.length},a.mosaic.undo.Stack.prototype.add=function(a){this.stack.length>=this.maxsize&&this.stack.pop(),this.stack.unshift(a)},a.mosaic.undo.Stack.prototype.get=function(a){return this.stack[a]},a.mosaic.undo.UndoManager=function(b,c,d){this.stack=new a.mosaic.undo.Stack(b),this.pointer=0,this.handler=c,"undefined"!=typeof d&&this.stack.add(d)},a.mosaic.undo.UndoManager.prototype.add=function(a){this.stack.add(a)},a.mosaic.undo.UndoManager.prototype.undo=function(){var a=this.stack.get(this.pointer+1);a&&(this.handler(a),this.pointer+=1)},a.mosaic.undo.UndoManager.prototype.redo=function(){var a=this.stack.get(this.pointer-1);a&&(this.handler(a),this.pointer-=1)}}),define("mosaic-url/mosaic.overlay",["jquery"],function(a){"use strict";"undefined"==typeof a.mosaic&&(a.mosaic={}),a.mosaic.overlay={},a.fn.mosaicOverlay=function(){return this.each(function(){var b=a(this);a(document.body,a.mosaic.document).append(b),b.addClass("mosaic-overlay");var c=a('<div class="mosaic-modal-wrapper" />');b.wrap(c),a(document.body,a.mosaic.document).prepend(a(document.createElement("div")).addClass("mosaic-overlay-blocker"))})},a.mosaic.overlay.open=function(b,c){var d,e,f,g,h,i,j,k;if(a(".mosaic-modal-wrapper").show().addClass("active"),a(".mosaic-overlay-blocker").show(),a("body").addClass("plone-modal-open"),d=a(".mosaic-overlay").find("form"),0===a(".mosaic-overlay-ok-button").length&&(a(".mosaic-overlay .formControls").children("input").hide(),a(".mosaic-overlay .formControls").append(a(document.createElement("input")).attr({type:"button",value:"Close"}).addClass("button-field context mosaic-overlay-ok-button").click(function(){a.mosaic.overlay.close()})),a(".mosaic-overlay").prepend(a(document.createElement("button")).attr({title:"Close"}).addClass("mosaic-overlay-close").html("&times;").click(function(){a.mosaic.overlay.close()}))),"all"===b){for(e=d.find("nav"),e.removeClass("mosaic-hidden"),d.find("fieldset").children().removeClass("mosaic-hidden"),d.find("fieldset").removeClass("active"),e.find("a").removeClass("active"),d.find(a.mosaic.options.customContentLayout_selector).addClass("mosaic-hidden"),d.find(a.mosaic.options.contentLayout_selector).addClass("mosaic-hidden"),a(".mosaic-IDublinCore-title-tile").size()>0?d.find("#formfield-form-widgets-IDublinCore-title").addClass("mosaic-hidden"):d.find("#formfield-form-widgets-IDublinCore-title").removeClass("mosaic-hidden"),a(".mosaic-IDublinCore-description-tile").size()>0?d.find("#formfield-form-widgets-IDublinCore-description").addClass("mosaic-hidden"):d.find("#formfield-form-widgets-IDublinCore-description").removeClass("mosaic-hidden"),g=0;g<a.mosaic.options.tiles.length;g+=1)"fields"===a.mosaic.options.tiles[g].name&&(f=a.mosaic.options.tiles[g]);for(g=0;g<f.tiles.length;g+=1)i=f.tiles[g],0!==a.mosaic.options.panels.find(".mosaic-"+i.name+"-tile").length&&a(a.mosaic.document.getElementById(i.id)).addClass("mosaic-hidden");d.find("fieldset").each(function(){0===a(this).children("div:not(.mosaic-hidden)").length&&a("a[href=#fieldsetlegend-"+a(this).attr("id").split("-")[1]+"]").addClass("mosaic-hidden")}),h=e.children(":not(.mosaic-hidden)"),h.eq(0).addClass("active");var l=d.find("#fieldset-"+h.eq(0).attr("href").split("-")[1]);0===l.size()&&(l=d.find("fieldset:not(.mosaic-hidden)").eq(0)),l.addClass("active")}else"field"===b&&(j=a("#"+c.id),k=j.parents("fieldset"),d.find("fieldset").hide(),k.show(),k.children().addClass("mosaic-hidden"),j.removeClass("mosaic-hidden"),d.find("nav").addClass("mosaic-hidden"))},a.mosaic.overlay.close=function(){a(".mosaic-modal-wrapper").hide().removeClass("active"),a(".mosaic-overlay-blocker").hide(),a("body").removeClass("plone-modal-open")}}),window.DEBUG=!0,require(["jquery","mockup-patterns-base","mosaic-url/mosaic.core","mosaic-url/mosaic.layout","mosaic-url/mosaic.toolbar","mosaic-url/mosaic.actions","mosaic-url/mosaic.upload","mosaic-url/mosaic.editor","mosaic-url/mosaic.undo","mosaic-url/mosaic.overlay"],function(a,b){"use strict";var c=b.extend({name:"layout",trigger:".pat-layout",parser:"mockup",defaults:{attribute:"class"},init:function(){var b=this;b.options.data.$el=b.$el,a.mosaic.init({data:b.options.data})}});return c}),define("/opt/plone/src/plone.app.mosaic/src/plone/app/mosaic/browser/static/js/mosaic.pattern.js",function(){});
//# sourceMappingURL=plone-mosaic.js.map